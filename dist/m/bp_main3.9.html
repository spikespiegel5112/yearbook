<!DOCTYPE html>
<html>

<head lang="ch">
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge，chrome=1">
	<title>忆尔3.9-书册预览</title>
	<link rel="stylesheet" href="../css/m.all.min.css">
	<link rel="stylesheet" href="../assets/css/font-awesome.css" type="text/css" />
	<link rel="stylesheet" href="../assets/css/iSlider.min.css" type="text/css" />
	<link rel="stylesheet" href="../assets/css/swiper.min.css" type="text/css" />
</head>

<body>
	<!--竖屏class:viewmode_portrait，横屏class:viewmode_landscape， 未登录状态class：bp_unsignedin_mode-->
	<div class='main_container'>
		<div class="ybwechatheader_wrapper">
			<a class='left_btn back_btn' href="javascript:;"><span class="ybiconfont ybicon-backward1"></span></a>
			<div class="bp_barrageswitch_item">
				<a href="javascript:;">
                    <div class="ybiconfont ybicon-barrageoff off"></div>
                    <div class="ybiconfont ybicon-barrageon on"></div>
				</a>
			</div>
			<div class="bp_paginator_item">
				<label>1</label>/<span>33</span>
			</div>
			<a class='bp_resizebtn_item' href="javascript:;"><span class="ybiconfont ybicon-fullscreen"></span></a>
			<a class='right_btn share_btn' href="javascript:;"><span class="ybiconfont ybicon-sharehollow"></span></a>
			<a class='bp_iwanttomake_btn' href="javascript:;">我要制作</a>
		</div>
		<div class="bp_flipbook_container">	
			<div class="flipbook-viewport">
				<div class='flipbook_wrapper' pagecount='19'>
					<a class='flipbook_prevpage_btn' href="javascript:;"><span></span></a>
					<div class='flipbook'>
						<div depth="5" class="hard" style="background-image:url('../img/default/1.jpg');">
							<link href="http://yb-test-book.qiniudn.com/pageTpl/IMAGE_TEXT/37/css/small_left.css" rel="stylesheet" type="text/css">
							<div class="container_activity_37_small_left">
								<div class="page_header_container">
									<div slottype="article" class="warp1">
										<div class="richShow" slottype="articleShow" textheight="40">
											<div class="main_title" slottype="richText" slotnum="0">
												雄关为头越
											</div>
										</div>
									</div>
								</div>
								<div class="photo0_container">
									<span id="imgMask0" imgwidth="1324" imgheight="907" slotnum="0" slottype="mask" class="photoframe_common_property photoframe0"></span>
									<img slottype="img" slotnum="0" class="img0" src="">
								</div>
								<div class="photo1_container">
									<span id="imgMask1" imgwidth="498" imgheight="334" slotnum="1" slottype="mask" class="photoframe_common_property photoframe1"></span>
									<img slottype="img" slotnum="1" class="img1" src="">
								</div>
								<div class="photo2_container">
									<span id="imgMask2" imgwidth="389" imgheight="261" slotnum="2" slottype="mask" class="photoframe_common_property photoframe2"></span>
									<img slottype="img" slotnum="2" class="img2" src="">
								</div>
								<div class="content_container">
									<strong>
									<div slottype="article" class="warp2">
										<div class="richShow" slottype="articleShow" textheight="30">
											<p></p>
											<p slottype="richText" slotnum="2" style="min-height:30px;" placeholder="活动标题" mode="inline"></p>
											<p></p>
										</div>
									</div>
								</strong>

									<div slottype="article" class="warp3">
										<div class="richShow" slottype="articleShow" textheight="96">
											<p slottype="richText" slotnum="3" style="display:block;word-wrap:break-word;" placeholder="活动内容"></p>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div depth="5" class="hard front-side secondcover even" style="background-image:url('../img/default/2.jpg');">
							<span class="depth"></span>
							<link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_left.css" rel="stylesheet" type="text/css">
							<div class="container_panoramic_02_small_left">
								<div slottype="article" class="warp">
									<div slottype="articleShow" textheight="62" class="richShow">
										<p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
										</p>
									</div>
								</div>
								<span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
								<img slottype="img" slotnum="1" src="" class="img1">
							</div>
						</div>
						<div class="hard fixed back-side thirdcover p19" style="background-image:url('../img/default/tpl_small.jpg')">
							<span class="depth"></span>
							<link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_right.css" rel="stylesheet" type="text/css">
							<div class="container_panoramic_02_small_right">
								<div slottype="article" class="warp">
									<div slottype="articleShow" textheight="62" class="richShow">
										<p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
										</p>
									</div>
								</div>
								<span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
								<img slottype="img" slotnum="1" src="" class="img1">
							</div>
						</div>
						<div class="hard p20" style="background-image:url('../img/default/tpl_small.jpg')"></div>
					</div>
					<a class='flipbook_nextpage_btn' href="javascript:;"><span></span></a>
				</div>
				<div class="bp_barrage_wrapper"></div>
			</div>
			<div class="bp_paginator_item">
				<label>1</label>/<span>33</span>
			</div>
			
		</div>
		<div class="bp_portrait_wrapper">
			<div class="bp_bookinfo_item">本书一共有<span>XX</span>页，可上传<span>XX</span>张照片</div>
			<div class="bp_menu_wrapper">
				<ul>
					<li>
						<a href="javascript:;" class='active'>
							<div class="comment"><span class="ybiconfont ybicon-commentsolid"></span></div>
							<p>评论(<span>123</span>)</p>
						</a>
					</li>
					<li>
						<a href="javascript:;">
							<div class="donate"><span class="ybiconfont ybicon-shangsolid1"></span></div>
							<p>赞助(<span>123</span>)</p>
						</a>
					</li>
					<li>
						<a href="javascript:;">
							<div class="praise"><span class="ybiconfont ybicon-praise"></span></div>
							<p>被赞(<span>123</span>)</p>
						</a>
					</li>
				</ul>
			</div>
			<div class="bp_iatab_wrapper">
				<div class="bp_comment_container">
					<div class='bp_comment_wrapper'>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/pc/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/pc/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/pc/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/pc/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/pc/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/pc/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
					</div>
					<div class="ybwechat_loading_item">
						<label><img class='loadingicon' src="../img/m/loading.gif">加载中...</label>
					</div>
					<div class='bp_empty_wrapper'>
						<img src="../img/m/preview_comment_empty_1_00000.png">
						<p>暂无数据</p>
					</div>
				</div>
				<div class='bp_donatetab_wrapper'>
					
					<div class='bp_donatedperson_wrapper'>
						<label>赞助过的人</label>
						<ul>
							<li>
								<div class='bp_donatedavatar_item'>
									<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								</div>
								<div class='bp_dontatedmessage_wrapper'>
									<div class='identification'>
										<span>小惆怅长岑长</span>
										<label>2015-12-31 17:30</label>
									</div>
									<div class='donatedprice'>
										<span class="ybiconfont ybicon-shangsolid1"></span>
										<label>￥20.00</label>
									</div>
									<p>新年快乐！新年快乐！新年快乐！新年快乐！新年快乐！</p>
								</div>
							</li>
							<li>
								<div class='bp_donatedavatar_item'>
									<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								</div>
								<div class='bp_dontatedmessage_wrapper'>
									<div class='identification'>
										<span>小惆怅长岑长</span>
										<label>2015-12-31 17:30</label>
									</div>
									<div class='donatedprice'>
                                        <span class="ybiconfont ybicon-shangsolid1"></span>
										<label>￥20.00</label>
									</div>
									<p>新年快乐！新年快乐！新年快乐！新年快乐！新年快乐！</p>
								</div>
							</li>
							<li>
								<div class='bp_donatedavatar_item'>
									<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								</div>
								<div class='bp_dontatedmessage_wrapper'>
									<div class='identification'>
										<span>小惆怅长岑长</span>
										<label>2015-12-31 17:30</label>
									</div>
									<div class='donatedprice'>
                                        <span class="ybiconfont ybicon-shangsolid1"></span>
										<label>￥20.00</label>
									</div>
									<p>新年快乐！新年快乐！新年快乐！新年快乐！新年快乐！</p>
								</div>
							</li>
							<li>
								<div class='bp_donatedavatar_item'>
									<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								</div>
								<div class='bp_dontatedmessage_wrapper'>
									<div class='identification'>
										<span>小惆怅长岑长</span>
										<label>2015-12-31 17:30</label>
									</div>
									<div class='donatedprice'>
                                        <span class="ybiconfont ybicon-shangsolid1"></span>
										<label>￥20.00</label>
									</div>
									<p>新年快乐！新年快乐！新年快乐！新年快乐！新年快乐！</p>
								</div>
							</li>
						</ul>
					</div>
					<a class='bp_iwanttodonate_btn' href="javascript:;"><label><span></span>我要赞助</label></a>
				</div>
				<div class='bp_praise_container'>
					<div class='bp_praisedperson_wrapper'>
						<label>赞过的人</label>
						<ul id="praiseUsers">
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>

							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
						</ul>
					</div>
					<a class='bp_praise_btn' href="javascript:;"><label><span class="ybiconfont ybicon-praise"></span>点赞</label></a>
				</div>
			</div>
		</div>
		<div class='bp_unsignedin_wrapper'>
			<div class='bp_iwangtomake_wrapper'>
				<a href="javascript:;">我要制作</a>
				<p>本书一共有20页，可上传60张照片</p>
			</div>
			<div class='bp_introduce_wrapper'>
				<ul>
					<li>
						<span class='ybiconfont ybicon-photobook'></span>
						<p>照片书：海量模板供您选择、在线编辑所见即所得、高清晰度印刷成册</p>
					</li>
					<li>
						<span class='ybiconfont ybicon-bookia'></span>
						<p>照片书：海量模板供您选择、在线编辑所见即所得、高清晰度印刷成册</p>
					</li>
				</ul>
				<div class='bp_logolink_wrapper'>
					<a href="javascript:;"><img src="../img/logo.png"></a>
				</div>
			</div>
			
		</div>
		<div class="bp_landscape_wrapper">
			<ul>
				<li class="comment">
					<a href="javascript:;">
						<div class="ybiconfont ybicon-commenthollow"></div>
					</a>
				</li>
				<li class="praise">
					<a href="javascript:;">
						<div class="ybiconfont ybicon-praise"></div>
					</a>
				</li>
				<li class="donate">
					<a href="javascript:;">
                        <div class="ybiconfont ybicon-shanghollow1"></div>
					</a>
				</li>
				<li class="share">
					<a href="javascript:;">
						<div class="ybiconfont ybicon-sharehollow"></div>
					</a>
				</li>
				<li class="bp_barrageswitch_item">
					<a href="javascript:;">
						<div class="ybiconfont ybicon-barrageoff off"></div>
                        <div class="ybiconfont ybicon-barrageon on"></div>
					</a>
				</li>
				<li class="bp_resizebtn_item">
					<a href="javascript:;"><span class="ybiconfont ybicon-narrow"></span></a>
				</li>
			</ul>
			<div class="chapter_slide">
				<a href="javascript:;">上一章</a>
				<a href="javascript:;">下一章</a>
			</div>
		</div>
		<div class='bp_donate_container'>
			<div class='bp_donate_wrapper'>
				<div class='bp_donatestep_wrapper step_1 hidden'>
					<h5>选择赞助金额</h5>
					<div class='bp_donatepannel_wrapper'>
						<ul>
							<li>
								<a href="javascript:;">
									<span>1</span>
									<label>元</label>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<span>2</span>
									<label>元</label>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<span>5</span>
									<label>元</label>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<span>10</span>
									<label>元</label>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<span>20</span>
									<label>元</label>
								</a>
							</li>
							<li>
								<input type='tel' maxlength='3' placeholder='自定义'/>
								<label>元</label>
							</li>
						</ul>
						<div class='bp_donatemessage_item'>
							<span>留言：</span>
							<input type='text' placeholder='做的不错哦，鼓舞一下！'>
						</div>
						<a class='donatebtn' href="javascript:;">立即赞助</a>
						<!-- <p>赞助无悔，概不退款</p> -->
					</div>
				</div>
				<div class='bp_donatestep_wrapper step_2'>
					<h4>选择支付方式</h4>
					<p>赞助<label>小叮当</label>用户:￥<span>20.00</span></p>
					<ul>
						<li>
							<a href="javascript:;"><label>银联在线</label><span class='icon-ok'></span></a>
						</li>
						<li>
							<a href="javascript:;"><label>支付宝</label><span class='icon-ok'></span></a>
						</li>
						<li>
							<a href="javascript:;"><label>微信支付</label><span class='icon-ok'></span></a>
						</li>
					</ul>
					<a class='donatebtn' href="javascript:;">立即支付</a>
				</div>
				<div class='bp_donatestep_wrapper waitingforpay'>
					<span class="ybiconfont ybicon-waitforpay"></span>
					<label>等待付款…</label>
					<a href="javascript:;"><span class="ybiconfont ybicon-closethin"></span></a>
				</div>
				<div class='bp_donatestep_wrapper step_3'>
					<span class="ybiconfont ybicon-successful"></span>
					<label>赞助成功！</label>
					<a href="javascript:;"><span class="ybiconfont ybicon-closethin"></span></a>
				</div>
				
			</div>
		</div>
		<div class="bp_sendcomment_item">
			<div class="input_box">
				<input id="reply-write" type="text" placeholder="这里输入聊天内容" />
				<button type="button"><i></i></button>
			</div>
		</div>
	</div>
	<div class='bp_photoslider_wrapper' id="iSlider-wrapper">
		<ol>
			<li>
				<a class="bp_resizebtn_item active" href="javascript:;"><span class="ybiconfont ybicon-backward1"></span></a>
			</li>
			<li class="praise">
				<a href="javascript:;"><span class="ybiconfont ybicon-praise"></span></a>
			</li>
			<li class="avatar">
				<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
			</li>
			
		</ol>
	</div>
	<div class='bp_sendcomment_container'>
		<div class='bp_sendcomment_wrapper'>
			<div class='bp_sendcommentbtn_wrapper'>
				<a class='cancel' href="javascript:;">取消</a>
				<a class='send' href="javascript:;">发送</a>
			</div>
			<div class='bp_commentavatar_item'>
				<img src="../img/m/default/vote_result_avatar_100_100_00000.jpg">
				<label>呆呆鱼呆呆鱼</label>
			</div>
			<textarea></textarea>
		</div>
	</div>
	<div class='loginpopup_container'>
		<div class='loginpopup_wrapper'>
			<h1>登录忆尔</h1>
			<ul class='loginpopup_input_wrapper'>
				<li>
					<span class="ybiconfont ybicon-user2"></span>
					<input type='text'>
				</li>
				<li>
                    <span class="ybiconfont ybicon-lock"></span>
					<input type='password'>
				</li>
			</ul>
			<a class='loginpopup_login_btn' href="javascript:;">登录</a>
			<p class='loginpopup_register_wrapper'>
				还没有账号？
				<a href="javascript:;">立即注册</a>
				<a href="javascript:;">忘记密码？</a>
			</p>
			<div class='loginpopup_ssologin_wrapper'>
				<p>第三方登陆，无须注册</p>
				<ul>
					<li class='qq'>
						<a href="javascript:;">
							<span class="ybiconfont ybicon-qqsolid"></span>
						</a>
					</li>
					<li class='wechat'>
						<a href="javascript:;">
                            <span class="ybiconfont ybicon-wechatsolid"></span>
						</a>
					</li>
					<li class='weibo'>
						<a href="javascript:;">
                            <span class="ybiconfont ybicon-weibosina"></span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="../assets/js/turn.js"></script>
	<script type="text/javascript" src="../assets/js/jquery.mobile.custom.min.js"></script>
	<script type="text/javascript" src="../assets/js/islider.js"></script>
	<script type="text/javascript" src="../assets/js/iSlider.plugin.zoompic.js"></script>
	<script type="text/javascript" src="../assets/js/swiper.jquery.min.js"></script>

	<script type="text/javascript" src="../js/m_base.js"></script>

	<script>
		var LOG = function() {
			return;
		};
		var LOG = alert;
		$(function() {
			bookpreviewInit();
			barrageSwitcher();
			collideLoading();
			
		});
		function bookpreviewInit() {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				flipbook = $('.flipbook'),
				flipbookViewport=$('.flipbook-viewport'),
				resizeBtn=$('.bp_resizebtn_item'),
				sliderResizeBtn=$('.bp_photoslider_wrapper .bp_resizebtn_item'),
				headerAndTools=$('.viewmode_landscape .ybwechatheader_wrapper, .bp_landscape_wrapper'),
				sendcommentEl=$('.bp_sendcomment_item'),
				loginpopupEl=$('.loginpopup_container');
			//横竖屏初始化注册事件的flag标记，让横竖屏的事件只注册一遍
			window.eventFlagPortrait = true,
			window.eventFlagLandscape = true;
			flipbook.attr('currentpage', 1);
			orientationSensor({
				portrait: function() {
					portraitHandler();
				},
				landscape: function() {
					landscapeHandler();
				}
			});
			// turnInit();
			resizeBtn.on('touchend',function(){
				var $this=$(this);
					if (!$this.hasClass('active')) {
					headerAndTools.removeClass('active');
					flipbookViewport.hide();
					sliderResizeBtn.show();
					iSliderinit();
					resizeBtn.each(function(){
						$(this).addClass('active');
					});
					$('.bp_photoslider_wrapper').show().css({
						'opacity': 1,
						'z-index': 2
					});
					orientationSensor({
						portrait:function(){
							sliderResizeBtn.css({
								top:'0%',
								left:'2%'
							});
						},
						landscape:function(){
							sliderResizeBtn.css({
								top:'0',
								left:'0%'
							});
						}	
					});
				}else{
					flipbook.show();
					flipbookViewport.show();
					orientationSensor({
						portrait:function(){return;},
						landscape:function(){
							headerAndTools.removeClass('active');
						}
					})
					
					sliderResizeBtn.hide();
					$('.bp_photoslider_wrapper').css({
						'z-index': '-1',
						'opacity':0
					})
					resizeBtn.each(function(){
						$(this).removeClass('active');
					});
				}
			});
			$('.bp_photoslider_wrapper .praise a').on('touchend', function(){
				$(this).toggleClass('active');
			});
			//点击赞助按钮后弹出赞助框
			$('.bp_iwanttodonate_btn, .bp_landscape_wrapper ul .donate').on('touchend',function() {
				popupDonateDialog();
			});
			$('.bp_sendcommentbtn_wrapper a').on('touchend', function(){
				$('.bp_sendcomment_container').hide();
				$('.main_container').show();
			});
			sendcommentEl.find('input').on('touchend', function(){
				loginpopupEl.show();
			});
			//点击登陆弹窗周围关闭登陆弹窗
			loginpopupEl.on('touchend', function(e){
				if ($(e.target).closest('.loginpopup_wrapper').length==0) {
					loginpopupEl.hide();
				};
			});

			$('.loginpopup_login_btn').on('touchend', function(){
				$('.main_container').hide();
				loginpopupEl.hide();
				$('.bp_sendcomment_container').show();
			});
			// 翻页，同时改变currentpage属性变量的值
			$('.flipbook_nextpage_btn').on('touchend', function() {
				flipbook.turn('next');
				flipbook.attr('currentpage', function() {
					return Number(flipbook.attr('currentpage')) + 2;
				});
			});
			$('.flipbook_prevpage_btn').on('touchend', function() {
				flipbook.turn('previous');
				flipbook.attr('currentpage', function() {
					return Number(flipbook.attr('currentpage')) - 2;
				});
			});
			
			//监听翻转事件
			$(window).on("orientationchange", function(event) {
				orientationHandler(event, {
					portrait: function() {
						flipbook.turn("destroy");
						portraitHandler();
					},
					landscape: function() {
						flipbook.turn("destroy");
						landscapeHandler();
					}
				});
			});
		}
		
		// 竖屏控制器
		function portraitHandler() {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				swiperFlag1=true,
				swiperFlag2=true,
				flipbookHeight=$('.bp_flipbook_container').height(),
				portraitHeader=$('.ybwechatheader_wrapper, .bp_barrageswitch_item'),
				resizeBtn=$('.bp_photoslider_wrapper .bp_resizebtn_item'),
				sendcommentEl=$('.bp_sendcomment_item');
			$.remResizing(20);
			$('.main_container').removeClass('viewmode_landscape').addClass('viewmode_portrait');
			$('.flipbook-viewport').css({
				'height': windowWidth * 0.5
			});
			$('.bp_sendcomment_container, .loginpopup_container').css({
				'height': windowHeight
			});
			turnInit();
			turnToCurrentpage();
			closeDonateDialog();
			resizeBtn.css({
				top:'0%',
				right:'2%'
			});
			if (window.eventFlagPortrait) {
				//当评论页数量为0时显示为空图标
				if ($('.bp_comment_wrapper table').length==0) {
					$('.bp_empty_wrapper').show();
				};
				$('.bp_photoslider_wrapper .resizeBtn').hide();
				$('.main_container').removeClass('viewmode_landscape').addClass('viewmode_portrait');

				$('.bp_menu_wrapper li:eq(0)').on('touchend', function(){
					var $this = $(this);
					$this.find('a').addClass('active');
					$('.bp_iatab_wrapper>div').hide();
					$('.bp_comment_container').show();
					$('.bp_menu_wrapper li').siblings('li').find('a').removeClass('active').end().eq(0).find('a').addClass('active');
					sendcommentEl.show();
				});
				$('.bp_menu_wrapper li:eq(1)').on('touchend', function(){
					var $this = $(this);
					var totalHeight=flipbookHeight+$('.bp_bookinfo_item').height()+$('.bp_menu_wrapper').height()+80;
					//当内容高度不够屏幕高度时手动计算css把高度填充满
					if(windowHeight-(totalHeight+100)>0){
						$('.bp_donatedperson_wrapper').css('height',function(){
							return windowHeight-totalHeight;
						});
					}
					$('.bp_donatepannel_wrapper input[type=tel]').keyup(function(){
						var thisVal=$(this).val();
						if (thisVal>200||/\D/.test(thisVal)) {
							console.log('gtgt')
							thisVal='';
						};
					});
					$this.find('a').addClass('active');
					$('.bp_iatab_wrapper>div').hide();
					$('.bp_donatetab_wrapper').show();
					$('.bp_menu_wrapper li').siblings('li').find('a').removeClass('active').end().eq(1).find('a').addClass('active');
					// if (swiperFlag1) {
					// 	var swiper = new Swiper('.bp_donatetab_wrapper .swiper-container', {
					// 	    slidesPerView: 'auto',
					// 	    centeredSlides: false,
					// 	    grabCursor: true
					// 	});
					// 	swiperFlag1=false;
					// };
					sendcommentEl.hide();
				});

				$('.bp_menu_wrapper li:eq(2)').on('touchend', function(){
					var $this = $(this),
						totalHeight=flipbookHeight+$('.bp_bookinfo_item').height()+$('.bp_menu_wrapper').height()+80;
					//当内容高度不够屏幕高度时手动计算css把高度填充满
					if(windowHeight-(totalHeight+100)>0){
						$('.bp_praisedperson_wrapper').css('height',function(){
							return windowHeight-totalHeight;
						});
					}
					$('.bp_iatab_wrapper>div').hide();
					$('.bp_praise_container').show();
					$('.bp_menu_wrapper li').siblings('li').find('a').removeClass('active').end().eq(2).find('a').addClass('active');
					// if (swiperFlag2) {
					// 	var swiper = new Swiper('.bp_praise_container .swiper-container', {
					// 	    slidesPerView: 'auto',
					// 	    centeredSlides: false,
					// 	    grabCursor: true
					// 	});
					// 	swiperFlag2=false;
					// };
					sendcommentEl.hide();
				});
				$('.bp_praise_btn').on('touchend', function(){
					var $this=$(this);
					$this.toggleClass('active');
					if (!$this.hasClass('active')) {
						$this.find('label').html('<span class="ybiconfont ybicon-praise"></span>'+'点赞')
					}else{
						$this.find('label').html('<span class="ybiconfont ybicon-praise"></span>'+'已赞')
					}
					
				});
				window.eventFlagPortrait=false;
			}
			if (windowWidth<=320) {
				$('.bp_donatestep_wrapper.step_1 li').children('input').css({
					'font-size':'1.6rem'
				});
			};
			$('.bp_landscape_wrapper, .ybwechatheader_wrapper').removeClass('active');
		}
		// 横屏控制器
		function landscapeHandler() {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				flipbook = $('.flipbook'),
				resizeBtn=$('.bp_photoslider_wrapper .bp_resizebtn_item'),
				commentInputEl = $('.bp_sendcomment_item');
			$.remResizing(20);
			$('.flipbook-viewport').css({
				'height': windowHeight
			});
				$('.bp_sendcomment_container, .loginpopup_container').css({
				'height': windowHeight
			});
			commentInputEl.hide();
			turnInit();
			turnToCurrentpage();
			closeDonateDialog();
			$('.main_container').removeClass('viewmode_portrait').addClass('viewmode_landscape');
			resizeBtn.css({
				top:'10%',
				right:'5%'
			});
			if (window.eventFlagLandscape) {
				var toolsEl=$('.ybwechatheader_wrapper, .viewmode_landscape .bp_landscape_wrapper');
				$('.flipbook_prevpage_btn, .flipbook_nextpage_btn, .ybwechatheader_wrapper').on('touchend', function(){
					toolsEl.removeClass('active');
				});
				flipbook.on('touchend', function(){
					toolsEl.addClass('active');
				});

				// $('.viewmode_landscape .bp_landscape_wrapper .comment').on('touchend', function() {
				// 	commentInputEl.toggle().on('touchend', function() {
				// 		$(document).on('touchend', function(e) {
				// 			if ($(e.target).closest('.bp_sendcomment_item').length == 0) {
				// 				$('.bp_donate_container, .bp_landscape_wrapper ul .donate a').removeClass('active');
				// 			};
				// 			$(this).unbind('touchend');
				// 		});
				// 	});
				// });
				$('.bp_landscape_wrapper li a').on('touchend', function(){
					var $this=$(this),
						index=$this.parent().index();
					if(index!=4&&$this.hasClass('active')){
						$this.removeClass('active');
					}else if(index!=4&&!$this.hasClass('active')){
						$this.addClass('active');
					}
				});
				//章节选择
				$('.chapter_slide a').on('touchend', function() {
					switch ($(this).index()) {
						case 0:
							flipbook.turn('previous');
							break;
						case 1:
							flipbook.turn('next');
							break;
					}
				});
				window.eventFlagLandscape=false;
			}
		}

		function iSliderinit(){
			$('.bp_photoslider_wrapper').find('ul').detach();
			var list = [
				{content: "../img/m/shop/shop_introduce_titlebg_00000.jpg"},
				{content: "../img/m/shop/shop_introduce_titlebg_00000.jpg"},
				{content: "../img/m/shop/shop_introduce_titlebg_00000.jpg"}
			];
			var newISlider = new iSlider({
				type: 'pic',
				data: list,
				dom: document.getElementById('iSlider-wrapper'),
				isLoading: true,
				isLooping: true,
				isOverspread: false,
				animateTime: 'default', // ms
				useZoom: true,
				plugins: [['zoompic', {zoomFactor: 8}]]
			});
			
		}

		function popupDonateDialog(){
			var windowHeight=$(window).height(),
				donateContainer=$('.bp_donate_container'),
				donateWrapper=$('.bp_donate_wrapper'),
				donatestep=$('.bp_donate_wrapper>div'),
				lastChildLiEl=$('.bp_donatepannel_wrapper li:last-child');
			
			orientationSensor({
				portrait:function(){
					donateWrapper.css({
						width:'90%',
						'margin-top': '20%'
					});
				},
				landscape:function(){
					donateWrapper.css({
						width:'60%',
						'margin-top': function() {
							return (windowHeight - $(this).height()) / 2
						}
					});
				}
			});
			donateContainer.addClass('active');
			lastChildLiEl.find('label').hide();
			lastChildLiEl.find('input').on('focus',function(){
				if ($(this).parent().hasClass('active')) {
					$(this).siblings('label').show();
				}else{
					$(this).siblings('label').show();
				}
			});
			//选择打赏金额
			$('.bp_donatepannel_wrapper ul li').on('touchend', function() {
				var $this=$(this)
				$this.siblings().removeClass('active').end().addClass('active');
				$this.parent().hasClass('active')?$this.siblings('label').show():$this.siblings('label').hide()
			});
			$('.bp_donatestep_wrapper.step_1 .donatebtn').on('touchend', function(){
				if ($('.bp_donatepannel_wrapper li').hasClass('active')) {
						$('.bp_donatestep_wrapper.step_1').hide().next().show();
					};
			});
			//选择支付方式
			$('.bp_donatestep_wrapper:eq(1) li').on('touchend', function(){
				$(this).siblings().removeClass('active').end().addClass('active');
			});
			$('.bp_donatestep_wrapper.step_2 .donatebtn').on('touchend', function(){
				if ($('.bp_donatestep_wrapper:eq(1) li').hasClass('active')) {
						$('.bp_donatestep_wrapper.step_2').hide().next().show();
					};
			});
			//等待付款界面的事件
			$('.bp_donatestep_wrapper.waitingforpay').on('touchend', function(){
				var $this=$(this);
				$this.hide().next().show();
				$this.find('a').on('touchend', function(){
					$this.hide().next().show();
					$(this).unbind('touchend');
				})
			})
			//支付完成提示
			$('.bp_donatestep_wrapper.step_3 a').on('touchend', function(){
				var $this=$(this);
				$('.bp_donate_container').removeClass('active');
				closeDonateDialog();
			});
			//点击打赏弹窗周围关闭打赏浮层
			donateContainer.on('touchend', function(e) {
				if ($(e.target).closest('.bp_donate_wrapper').length == 0) {
					closeDonateDialog();
				}
			});
			
			
			
			// $('.bp_donatestep_wrapper').each(function(index){
			// 	var $this=$(this);
			// 	switch (index){
			// 		case 0:
			// 			$this.find('.donatebtn').on('touchend',function(){
			//				if ($('.bp_donatepannel_wrapper li').hasClass('active')) {
			//					$this.hide().next().show();
			//				};
			//			});
			// 			break;
			// 		case 1:
			// 			$this.find('.donatebtn').on('touchend',function(){
			// 				if ($('.bp_donatestep_wrapper:eq(1) li').hasClass('active')) {
			// 					$this.hide().next().show();
			// 				};
			// 			});
			// 			break;
			// 		case 2:
			// 			$this.find('a').on('touchend',function(){
			// 				$('.bp_donate_container').removeClass('active');
			// 				$this.prev().prev().show();
			// 				$this.hide();
			// 				closeDonateDialog();
			// 			});
			// 			break;
			// 	}
			// });
		}
		function turnToCurrentpage() {
			var flipbook = $('.flipbook');
			flipbook.turn('page', Number(flipbook.attr('currentpage')));
		}
		// 书册大小重定义
		function flipbookResize() {
			var zoom = 0,
				windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				originalWidth = 680,
				originalHeight = 960,
				portraitFactor = 0.7,
				landscapeFactor = 0.87;
			orientationSensor({
				portrait: function() {
					var zoom = windowWidth / (originalWidth * 2) * portraitFactor;
					$('.flipbook .page>div').css(sizeArguObj(zoom));
				},
				landscape: function() {
					var zoom = windowHeight * (landscapeFactor / originalHeight);
					$('.flipbook .page>div').css(sizeArguObj(zoom));
				}
			});

			// 尺寸设定集
			function sizeArguObj(zoom) {
				return {
					'-ms-zoom': zoom,
					'-webkit-transform': 'scale(' + zoom + ')',
					'-webkit-transform-origin': 'left top',
					'-moz-transform': 'scale(' + zoom + ')',
					'-moz-transform-origin': 'left center'
				}
			}
		}

		function turnInit() {
			var bookIdx = 2,
				windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				flipbook = $('.flipbook'),
				zoom = 0,
				flipbookWidth = orientationSensor({
					portrait: function() {
						return 3496 * (windowWidth / 3496) * 0.7;
					},
					landscape: function() {
						return 3496 * (windowHeight / 2480) * 0.87;
					}
				});
			$('.page-wrapper .page').addClass('hard');
			flipbook.addClass('animated');
			flipbook.turn({
				width: flipbookWidth,
				height: flipbookWidth * 0.7,
				acceleration: !isChrome(),
				autoCenter: true,
				gradients: true,
				duration: 1000,
				pages: bookLength(),
				when: {
					turning: function(e, page, view) {
						var currentPage = flipbook.turn('page'),
							pages = bookLength();
						disableControls(page);
						if (currentPage > 3 && currentPage < pages - 3) {
							if (page == 1) {
								flipbook.turn('page', 2).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							} else if (page == pages) {
								flipbook.turn('page', pages - 1).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							}
						} else if (page > 3 && page < pages - 3) {
							if (currentPage == 1) {
								flipbook.turn('page', 2).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							} else if (currentPage == pages) {
								flipbook.turn('page', pages - 1).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							}
						}

						if (page >= 2) {
							$('.flipbook_wrapper .p2').addClass('fixed');
						} else {
							$('.flipbook_wrapper .p2').removeClass('fixed');
						}
						if (page < bookLength()) {
							$('.flipbook_wrapper .p' + (bookLength() - 1)).addClass('fixed');
						} else {
							$('.flipbook_wrapper .p' + (bookLength() - 1)).removeClass('fixed');
						}
					},
					turned: function(e, page, view) {
						disableControls(page);
					},
					start: function(e, pageObj) {},
					end: function(e, pageObj) {
						
						flipbookResize();
						$('.bp_paginator_item label').text(flipbook.turn('page'));
					},
					missing: function(e, pages) {
						for (var i = 0; i < pages.length; i++) {
							addPage(bookIdx, pages[i], $(this), flipbookWidth);
						}
					}
				}
			});
			$('.flipbook_wrapper').css({
				width: flipbookWidth
			});

			setTimeout(function() {
				flipbookResize();
			}, 50)

			function isChrome() {
				return navigator.userAgent.indexOf('Chrome') != -1;
			}

			function bookLength() {
				var length = $('.flipbook_wrapper').attr('pagecount');
				if (length % 2 != 0) {
					return parseInt(length) + 1;
				} else {
					return length;
				}
			}

			function addPage(bookIdx, page, book, flipbookWidth) {
				var pages = book.turn('pages');
				if (!book.turn('hasPage', page)) {
					var element = $('<div />', {
						'class': 'own-size',
						css: {
							width: flipbookWidth / 2,
							height: flipbookWidth * 0.7
						}
					}).html('<div class="loader"></div>');
					if (book.turn('addPage', element, page)) {
						loadPage(bookIdx, page);
					}
				}

				function loadPage(bookIdx, page) {
					$.ajax({
						url: '../flipbookpages/' + bookIdx + '/page' + page + '.html'
					}).done(function(pageHtml) {
						$('.flipbook .p' + page).html(pageHtml.replace('yb3.0/flipbookpages/', ''));
					});
				}
			}

			function disableControls(page) {
				var prevBtn = $('.flipbook_prevpage_btn'),
					nextBtn = $('.flipbook_nextpage_btn')
				if (page == 1) {
					prevBtn.hide();
					nextBtn.show();
				} else if (page == flipbook.turn('pages')) {
					prevBtn.show();
					nextBtn.hide();
				} else {
					prevBtn.show();
					nextBtn.show();
				}
			}
		}

		/*
		 * 弹幕开关
		 * */
		function barrageSwitcher() {
			var commentJSON = {
				"commentArr": [{
					"comment": "感谢你，啦啦啦"
				}, {
					"comment": "嗯嗯嗯爱爱爱爱啊"
				}, {
					"comment": "我的天呀"
				}, {
					"comment": "good good good "
				}, {
					"comment": "O(∩_∩)O哈哈哈~"
				}, {
					"comment": "嗯嗯嗯爱爱爱爱啊"
				}, {
					"comment": "我的天呀"
				}, {
					"comment": "good good good "
				}, {
					"comment": "嗯嗯嗯爱爱爱爱啊"
				}, {
					"comment": "我的天呀"
				}, {
					"comment": "good good good "
				}, {
					"comment": "11111"
				}, {
					"comment": "22222"
				}, {
					"comment": "33333"
				}]
			}
			$(".bp_barrageswitch_item").on('touchend', function() {
				var switcher = $(this).find('a');
				if (!switcher.hasClass('active')) {
					switcher.addClass('active');
					$(".bp_barrage_wrapper").show();
					var commentEl = new Array();
					for (var i = 0; i < commentJSON.commentArr.length; i++) {
						commentEl[i] = commentJSON.commentArr[i];
					};
					//把数据载入好了，就传给barrage()函数就直接发弹幕了
					barrage(commentEl);
				} else {
					$(".bp_barrage_wrapper").hide().find('div').remove();
					switcher.removeClass('active')
				}
			})
		}

		$('.bp_sendcommentbtn_wrapper .send').on('touchend', function() {
			var comment = $('.bp_sendcomment_wrapper textarea').val();
			if ($.trim(comment) == "") {
				alert("亲，请输入你的想说的话！");
				return false;
			} else {
				barrage(comment);
				comment='';
			}
		});

		function barrage(comment) {
			console.log(comment);
			var commentLength = 1;
			$('.bp_barrage_wrapper').show();
			if (typeof(comment) == 'object') {
				var commentLength = comment.length;
				for (var i = 0; i < commentLength; i++) {
					loadandfire(comment[i].comment);
				}
			} else {
				var commentEl = new Array();
				commentEl[0] = comment;
				loadandfire(commentEl[0]);
			}

			function loadandfire(comment) {
				var windowWidth = $(window).width(),
					windowHeight = $(window).height(),
					//拼装弹幕字符元素
					comment = $('<div></div>').addClass('barrage').css({
						'position': 'absolute',
						'left': windowWidth + 100,
						'top': windowWidth * 0.5 * Math.random(1),
						'color': getReandomColor(),
						'font-size': getReandomFontSize()
					}).html('<p>' + comment + '</p>');

				$(".bp_barrage_wrapper").append(comment);
				setTimeout(function() {
					animateBarrage(windowWidth, comment);
				}, 100);
			}

			//对弹幕元素添加动画
			function animateBarrage(windowWidth, commentEl) {
				commentEl.addClass('active').css({
					'left': -windowWidth,
					'-webkit-transition': 'left ' + getRandomTime() + 's',
					'-moz-transition': 'left ' + getRandomTime() + 's'
				});
				console.log(getRandomTime());
				commentEl.removeClass('active');
			}
		}

		//屏幕方向探测器
		function orientationSensor(callback) {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height();
			if (typeof(callback) == 'undefined') {
				callback = {
					portrait: function() {},
					landscape: function() {}
				}
			} else {
				if (windowWidth < windowHeight) {
					return callback.portrait();
				} else {
					return callback.landscape();
				}
			}
		}
		//方向判断回调工具
		function orientationHandler(event, callback) {
			if (typeof(callback) == 'undefined') {
				callback = {
					portrait: function() {},
					landscape: function() {}
				}
			}
			switch (event.orientation) {
				case 'portrait':
					callback.portrait();
					console.log("方法改变为：" + event.orientation);
					break;
				case 'landscape':
					callback.landscape();
					console.log("方法改变为：" + event.orientation);
					break;
			}
			return callback;
		}

		//随机获取颜色值
		function getReandomColor() {
			return '#' + (function(h) {
				return new Array(7 - h.length).join("0") + h
			})((Math.random() * 0x1000000 << 0).toString(16));
		}
		//随机获取字号
		function getReandomFontSize() {
			return (function() {
				return Math.floor(Math.random() * (45 - 12 + 1) + 12) + 'px';
			});
		}
		//获取随机时间，range表示时间随机范围，offset表示不少于多少秒
		function getRandomTime(config) {
			config = $.extend({
				range: 20,
				offset: 15
			}, config);
			return Math.random(1) * config.range + config.offset;
		}
		function closeDonateDialog(){
			$('.bp_donate_container').removeClass('active');
			$('.bp_donatestep_wrapper:eq(0)').show().siblings().hide();
			$('.bp_landscape_wrapper .donate a').removeClass('active');
		}
		function collideLoading() {
			var loadingFlag=true,
				commentLength=$('.bp_comment_wrapper table').length;
			$.collideLoading({
				onScrollBottom: function() {
					var commentEl = '<table><tr><td><div class="user_header"><img src="../img/m/pc/user_default_head.png"></div></td><td><div class="user_name"><span>username</span></div></td><td><div class="commet_time"><span>2015-12-31</span></div></td></tr><tr><td colspan="3" class=""><p>说些什么什么事什么什么事没什么事忙什么什么事...</p></td></tr></table>';

					//这个变量用来约束标签页只在打开了评论的情况下可触发底部加载事件
					var index=$('.bp_menu_wrapper .active').parent().index();
					//用一个flag来约束加载逻辑使其在完成加载过程前触发的底部碰撞事件无效
					if (commentLength==0) {
						return;
					}else if (loadingFlag&&index==0) {
						loadingFlag=false;
						$('.ybwechat_loading_item').show();
						setTimeout(function() {
							$('.bp_comment_wrapper').append(commentEl);
							$('.ybwechat_loading_item').hide();
							loadingFlag=true;
						}, 3000);
					};
					
				}
			});
		}
	</script>
</body>

</html>
