<!DOCTYPE html>
<html>

<head lang="en">
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="keywords" content="">
	<title>忆尔3.0-新建投票</title>
	<link rel="stylesheet" href="http://at.alicdn.com/t/font_1459411789_462414.css" type="text/css" media="all">
	<!-- build:css css/all.min.css -->
	<link rel="stylesheet" href="css/reset.css" type="text/css" media="all">
	<link rel="stylesheet" href="css/common.css" type="text/css" media="all">
	<link rel="stylesheet" href="css/ia.css" type="text/css" media="all">
	<!-- endbuild -->
	<link rel="stylesheet" href="assets/css/font-awesome.css" type="text/css" media="all">
    <link rel="stylesheet" href="assets/css/green.css">

    <style>
	/*  .create_votelist span.radiobox {
		position: absolute;
		left: 20px;
		top: 0px;
		left: 30px\0;
		top: 8px\0;
	}*/
	</style>
</head>

<body>
	<!--头部导航-->
	<div class='ybnav_wrapper'>
		<div class='headerlogo_item'>
			<img src="img/logo.png" width='226' height='42'>
		</div>
		<div class='ybnav_nav_wrapper'>
			<ul>
				<li><a href="index.html">首页</a></li>
				<li><a href="booklist_photo.html">照片书</a></li>
				<li><a href="booklist_ia.html" class="active">互动册</a></li>
				<li><a href="pc_mybookshelf.html">个人中心</a></li>
				<li><a href="static_instruction_entrance.html">使用指南</a></li>
			</ul>
		</div>
		<div class='ybnav_userinfo_wrapper'>
			<ul>
				<li class='ybnav_avatar_item'>
					<a href="javascript:;"><img src='img/default/user_img1.jpg' width='25' height='25'></a>
				</li>
				<li class='ybnav_username_item'><a href="javascript:;">HI,admin</a></li>
				<li class='ybnav_message_item'>
				<a class='ybiconfont ybicon-bookcenter' href="javascript:;"></a>
			</li>
				<li class='ybnav_logout_item'>
					<a class='ybiconfont ybicon-turnoff' href="javascript:;"></a>
				</li>
			</ul>
		</div>
	</div>
	<!--banner-->
	<div class='ybbanner_wrapper'>
		<div class='ybbanner_bookinfo_wrapper'>
			<a href="bp_main.html">
				<img class='ybbanner_bookcover_item' src="img/default/cover_css.jpg" width='80' height='120'>
			</a>
			<div class='ybbanner_bookinfo_item'>
				<div class='ybbanner_bititle_item'>
					<h6>十五个字符十五个字符十五个字符十五个字符</h6>
					<a class="ybbanner_titleedit_item" href="javascript:;"><span class="icon-edit"></span></a>
				</div>
				<div class='ybbanner_biinfo_item'>
					<label>班级名：</label>
					<p>XXXXXXXXXXXX</p>
				</div>
				<div class='ybbanner_biinfo_item'>
					<label>学校名：</label>
					<p>学校学校学校学校学校学校学校学校学校学校学校学校学校学校学校学校学校学校学校学校</p>
				</div>
			</div>
		</div>
		<div class='bannerslider_wrapper'>
			<a class='bs_arrowbtn_left' href="javascript:;"></a>
			<div class='bannerslider_inner'>
				<ul>
					<li class='bookspace'>
						<a class='active' href="ia_bookspace.html">
							<span class='ybiconfont ybicon-bookshelf'></span>
							<p>书册空间</p>
						</a>
					</li>
					<li class='chaptermaker'>
						<a class='active' href="makebook_chaptermake.html">
							<span class='ybiconfont ybicon-editbook'></span>
							<p>编辑制作</p>
						</a>
					</li>
					<li class='interaction'>
						<a class='active' href="ia_entrance.html">
							<span class='ybiconfont ybicon-iabook'></span>
							<p>书册互动</p>
						</a>
					</li>
					<li class='bookmanagement'>
						<a class='active' href="ia_albumlist.html">
							<span class='ybiconfont ybicon-photobook'></span>
							<p>相册管理</p>
						</a>
					</li>
					<li class='friendmanagement'>
						<a class='active' href="ia_friend.html">
							<span class='ybiconfont ybicon-partner'></span>
							<p>小伙伴管理</p>
						</a>
					</li>
				</ul>
			</div>
			<a class='bs_arrowbtn_right' href="javascript:;"></a>
		</div>
		<div class='ybbanner_shortcut_wrapper'>
			<ul>
				<li class='print'><a href="javascript:;">提交下单</a></li>
				
				<li class='share'><a href="javascript:;">分享预览</a></li>
				<li class='invite'><a href="javascript:;">邀请卡</a></li>
			</ul>
		</div>
	</div>
	<!-- main -->
	<div class="ia_list_main">
		<div class="ia_list_con ia_topic_con">
			<div class="module_title_item">
				<h5>
				<ul class="bread_nav">
					<li class="cm_fl cm_ml_5"><a href="ia_entrance.html">互动</a></li>
					<li class="cm_fl cm_ml_5"><a href="ia_votelist_index.html">民主选举</a></li>
					<li class="cm_fl cm_ml_5">新建投票</li>
				</ul>
			</h5>
				<div class="dash">
					<div class="dash_92c153"></div>
				</div>
			</div>
			<div class="create_votelist">
				<ul>
					<li>
						<p class="cm_fl lp1">选择图标</p>
						<div class="cm_fl">
							<img src="img/icon/vote_default_img.png">
						</div>
						<div class="cm_fl btn1"><a href="javascript:;">选择文件</a></div>
					</li>
					<form id="commentForm">
						<li>
							<p class="cm_fl lp2">投票主题</p>
							<div class="cm_fl">
								<input class="data cm_fl required" id="vtitle" name="voteTitle" placeholder="" type="text">
							</div>
						</li>
						<li class='votetype_item'>
							<p class="cm_fl">投票类型</p>
							<div class="pos_rel cm_w_120">
								<input name="votetype" type="radio" value="1" id="normalvote" tabindex="3" class="radio_btn required">
								<label class="radiobox" for='normalvote'>普通投票</label>
							</div>
							<div class="pos_rel cm_ml_10">
								<input name="votetype" type="radio" value="1" id="membervote" tabindex="3" class="radio_btn2">
								<label class="radiobox" for='membervote'>成员投票</label>
							</div>
						</li>
						<li>
							<p class="cm_fl lp2">投票选项</p>
							<div class="voteoption_wrapper normal_voteoption_wrapper">
								<ul>
									<li>
										<div class='voteoption_item'>
											<input placeholder='' type='text'>
										</div>
										<a href="javascript:;"><i class="icon-plus-sign icon-large"></i></a>
									</li>
								</ul>
								<span>最多可创建12项</span>
							</div>
							<div class='voteoption_wrapper member_voteoption_wrapper'>
								<div class='membervoteoption_wrapper'>
									<div class='membervoteoption_item'>
										<input class='required valid' id='mvo_all' type='radio' name='membervoterange'>
										<label for='mvo_all'>全选</label>
									</div>
									<div class='membervoteoption_item'>
										<input class='required valid' id='mvo_male' type='radio' name='membervoterange'>
										<label for='mvo_male'>全体男生</label>
									</div>
									<div class='membervoteoption_item'>
										<input class='required valid' id='mvo_female' type='radio' name='membervoterange'>
										<label for='mvo_female'>全体女生</label>
									</div>
									<div class='membervoteoption_item'>
										<input class='required valid' id='mvo_custom' type='radio' name='membervoterange'>
										<label for='mvo_custom'>自定义</label>
										<a class='addoption_btn' href="javascript:;">添加选项</a>
									</div>
								</div>
								<ul></ul>
							</div>
						</li>
						<li>
							<p class="cm_fl lp2">投票模式</p>
							<div class="votepattern_wrapper">
								<div class="pos_rel cm_fl cm_w_120">
									<input name="votepattren" type="radio" value="1" id="single" tabindex="3" class="radio_btn required">
									<label class="radiobox" for='single'>单选</label>
								</div>
								<div class="pos_rel cm_fl cm_w_120 cm_ml_10">
									<input name="votepattren" type="radio" value="1" id="multi" tabindex="3" class="radio_btn2">
									<label class="radiobox" for='multi'>多选</label>
									<input type='text' maxlength='3' disabled='disabled'>
								</div>
							</div>
						</li>
						<li>
							<p class="cm_fl lp2">投票描述</p>
							<div class="votedesc_wrapper">
								<textarea class='required' maxlength='200' name='votedesc'></textarea>
							</div>
						</li>
						<li>
							<input name="anonymousvote" type="checkbox" value="1" id="anonymousvote" tabindex="3" class="checkbox_btn">
							<label class="cm_ml_5" for='anonymousvote'>匿名投票</label>
						</li>
					</form>
					<li>
						<p class="cm_fl lp5"><a class='cv_ok_item yb_book_btn' href="#">完成</a></p>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!--底部-->
	<div class="footer">
		<div class="footer_info">
			<a class="common_yblogoshort_item ybiconfont ybicon-yblogoshort" href="javascript:;"></a>
			<div class="footer_title">
				<div>忆尔-在线DIY纪念册平台</div>
				<p>专业在线制作电子书册平台</p>
				<p>DIY出独一无二的青春纪念册</p>
			</div>
		</div>
		<div class="footer_list">
			<div class='footer_qrcode_wrapper'>
				<img src="img/footer_wx.png">
			</div>
			<div class='footer_listleft_wrapper'>
				<div class="ft_nav">
					<a href="javascript:;">客服电话 400 0610 127</a>
					<a href="javascript:;">客服QQ</a>
					<a href="javascript:;">客服邮箱</a>
					<a href="javascript:;">关于我们</a>
				</div>
				<p class="ft_copyright">苏ICP备11087253号-2 \ © 2014 无锡众志和达数据计算股份有限公司</p>
				<div class="ft_shares">
					<a href="javascript:;" class="x83"><img src="img/hy_83x30.png"></a>
					<a class='ybiconfont ybicon-weibotencent' href="javascript:;"></a>
					<a class='ybiconfont ybicon-weibosina' href="javascript:;"></a>
					<a class='ybiconfont ybicon-wechatsolid' href="javascript:;"></a>
				</div>
			</div>
		</div>
	</div>
	<div class='voteoption_member_dialog_wrapper'>
		<div class='main_wrapper'>
			<ul>
				<!--            <li>
					<a href="javascript:;">
						<span><img src="img/bookmanagement/vote_result_avatar_50_50_00000.jpg"></span>
						<label>张三</label>
					</a>
				</li>
				<li>
					<a href="javascript:;">
						<span><img src="img/bookmanagement/vote_result_avatar_50_50_00000.jpg"></span>
						<label>张三</label>
					</a>
				</li>
				<li>
					<a href="javascript:;">
						<span><img src="img/bookmanagement/vote_result_avatar_50_50_00000.jpg"></span>
						<label>张三</label>
					</a>
				</li> -->
			</ul>
		</div>
	</div>
	<script type="text/javascript" src='assets/js/jquery.min.js'></script>
	<script type="text/javascript" src='assets/js/jquery.artDialog.js?skin=yb3'></script>
	<script type="text/javascript" src="assets/js/jquery.validate.js"></script>
    <script type="text/javascript" src="assets/js/icheck.js"></script>
	<!-- build:js js/all.js -->
	<script type="text/javascript" src="js/base.js"></script>
	<!-- endbuild -->
    <script>
	var voteSwitcher = {
		init: function(callback2) {
			var _this = this;
			var voCon = $('.voteoption_wrapper');
			var errHtml = '<label class="normalvite_error">投票选项未填写</label>';
			this.normalVote();
			this.memberVote(callback2);
            $('.create_votelist .votetype_item input').on('ifClicked',function(){
                if ($(this).parent().parent().index() == 1) {
                    voCon.eq(0).show();
                    voCon.eq(1).hide();
                } else {
                    voCon.eq(1).show();
                    voCon.eq(0).hide();
                }
            });
			$('.votepattern_wrapper input').on('ifClicked',function() {
                var $this = $(this);
                if ($this.index('.votepattern_wrapper input') == 1) {
                    $(this).parent().siblings('input').removeAttr('disabled');
                } else if ($this.index('.votepattern_wrapper input') == 0) {
                    $('.votepattern_wrapper input').eq(2).attr('disabled', 'disabled');
                }
            });
			$('.cv_ok_item').click(function() {
				if ($('.create_votelist .votetype_item').find('input:checked').parent('div').index() == 1) {
					$('.normal_voteoption_wrapper li').each(function() {
						var $this = $(this);
						if ($this.find('label').length != 0) {
							return;
						} else if ($this.find('input').val() == '' && $this.find('input').attr('disabled') != ' disabled') {
							$this.append(_this.errHtml());
						}
					});
				} else {
					if ($('.member_voteoption_wrapper ul li').length == 0) {

					}
				}
			});
		},
		normalVote: function() {
			var _this = this;
			var voCon = $('.voteoption_wrapper');
			voCon.eq(0).show();
			voCon.eq(1).hide();

			voCon.eq(0).find('input').attr('disabled', 'disabled');
			$('.votetype_item div input').on('ifChanged',function() {
                voCon.eq(0).find('input').removeAttr('disabled');
            });

			voCon.on('click', '.icon-minus-sign', function() {
				removeOption($(this));
			});
			voCon.on('click', '.icon-plus-sign', function() {
				if (voCon.eq(0).find('input').attr('disabled') == 'disabled') {
					return;
				} else if (voCon.eq(0).find('li').length < 12 && voCon.eq(0).find('input').attr('disabled') == undefined) {
					addOption($(this));
				} else {
					$('.normal_voteoption_wrapper span').show();
				}
			});

			$('.normal_voteoption_wrapper').on('keyup', 'ul li', function() {
				var $this = $(this);
				if ($this.find('input').val() != '') {
					$this.find('.normalvite_error').remove();
				} else if ($this.find('label').length == 0) {
					$this.append(_this.errHtml());
				} else {
					return;
				}
			});

			function removeOption(el) {
				el.closest('li').remove();
			}

			function addOption(el) {
				var tbody = el.closest('table').children();
				var voCon0 = $('.voteoption_wrapper').eq(0).find('ul');
				el.removeClass('icon-plus-sign');
				el.addClass('icon-minus-sign');
				var row2 = $("<tr></tr>");
				voCon0.append(addLi());
				tbody.append(row2);

				function addLi() {
					return '<li><div class="voteoption_item"><input type="text"></div><a href="javascript:;"><i class="icon-plus-sign icon-large"></i></a></li>';
				}
			}
		},
		memberVote: function(callback2) {
			var _this=this;
			var memberArr = [];
			var memberIndexArr=[];
			var memberVoteList = $('.member_voteoption_wrapper').find('ul');
			var memberWrapper = $('.voteoption_member_dialog_wrapper .main_wrapper ul');
			var memberVoteOption = $('.membervoteoption_wrapper .membervoteoption_item').find('input');
			var customFlag = false;
			memberVoteOption.on('ifClicked',function() {
				var $this = $(this);
				// var addBtn = $('.membervoteoption_wrapper div').eq(3).find('.addoption_btn');
				if ($this.parent().parent().index() == 3) {
					customFlag = true;
					if (customFlag == true) {
						$this.closest('.membervoteoption_wrapper').siblings('ul').show();
					}
				} else {
					if (customFlag == true) {
						$this.closest('.membervoteoption_wrapper').siblings('ul').hide();
						customFlag = false;
					}
				}
			});
			$('.voteoption_wrapper .addoption_btn').click(function() {
				//如果自定义投票flag不为真就打不开弹窗
				if (customFlag != true) {
					return;
				};
				//点击添加选项按钮后就把数据加载到memberWrapper这个弹窗里，然后显示,这个循环表示的是从后台加载数据到弹窗的操作
				for (var i = 0; i < 30; i++) {
					memberWrapper.append(_this.memberoption(i));
				};
				//给每个弹窗的成员投票选项指定一个id
				for (var i = 0; i < memberWrapper.find('li').length; i++) {
					memberWrapper.find('li').eq(i).attr('id', 'memvote_' + i);
				};
				art.dialog({
					title: '投票详情',
					lock: true,
					content: document.querySelector('.voteoption_member_dialog_wrapper'),
					ok: function() {
						for (var i = 0; i < memberIndexArr.length; i++) {
							memberVoteList.append("<li class='memberoption'><div>" + memberArr[i] + "</div><a href='javascript:;'><i class='icon-minus-sign icon-large'></i></a></li>");
						}
						console.log(memberIndexArr)
						memberArr.splice(0, memberIndexArr.length);
						//关闭弹窗后清除弹窗内的元素
						memberWrapper.empty();
					},
					cancelVal: '取消',
					cancel: function() {
						//关闭弹窗后清除弹窗内的元素
						memberWrapper.empty();
					} //为true等价于function(){}
				});
			});
			//点击弹窗中的头像投票
			memberWrapper.on('click', 'li a', function() {
				var $this = $(this);
				var thisIndex = $this.parent().index();
				// console.log(thisIndex)
				if ($this.hasClass('selected')) {
					$this.css({
						border: '2px solid #eee'
					}).removeClass('selected');
					memberArr.splice($this, 1);
					memberIndexArr[thisIndex].splice(1);
				} else {
					$this.css({
						border: '2px solid #8cd419'
					}).addClass('selected');
					memberArr.push($this.html());
					memberIndexArr.push(thisIndex);
				}
			});
		},

		memberoption: function(name) {
			return "<li class='male'><a href='javascript:;'><span><img src='img/default/book_step_one.png'></span><label>" + name + "</label></a></li>";
		},
		errHtml: function() {
			return '<label class="normalvite_error">投票选项未填写</label>';
		}
	}

	function validateForm() {
		//validate方法参数可选  
		return $('#commentForm').validate({
			messages: {
				voteTitle: {
					required: "投票标题未填写"
				},
				votetype: {
					required: "投票类型未选择"
				},
				membervoterange: {
					required: "投票范围未选择"
				},
				votepattren: {
					required: "投票模式未选择"
				},
				votedesc: {
					required: "投票描述未填写"
				}
			},
			errorPlacement: function(error, element) {
				error.appendTo(element.closest('li'));
			}
		}).form();
	}

	function doSubmit() { //点击登录触发验证
		$('.lp5').click(function() {
			if (validateForm()) {
				document.form1.submit()
			}
		});

	}

    //渲染控件样式
    function changeButtonCss() {
        $("input[type=radio],input[type=checkbox]").iCheck({
            checkboxClass: 'icheckbox_minimal-green',
            radioClass: 'iradio_minimal-green',
            increaseArea: '20%'
        });
    }
	(function($) {
		doSubmit();
		// $('.manage_tab').scrollFixedTools(395);
		voteSwitcher.init();
        changeButtonCss();
	}(jQuery));
	</script>
</body>

</html>
