<!DOCTYPE html>
<html>

<head lang="ch">
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge，chrome=1">
	<title>忆尔3.9-书册预览</title>
	<!-- build:css ../css/m.all.min.css -->
	<link rel="stylesheet" href="../css/m_reset.css" type="text/css" />
	<link rel="stylesheet" href="../css/m_common.css" type="text/css" />
	<link rel="stylesheet" href="../css/m_bookpreview.css" type="text/css" />
	<!-- endbuild -->
	<link rel="stylesheet" href="../assets/css/font-awesome.css" type="text/css" />
</head>

<body>
	<div class='main_container'>
		<!--竖屏class:bp_con_v has_footer_nav，横屏class:bp_con_h-->
		<div class="bp_flipbook_container">
			<div class="ybwechatheader_wrapper">
				<a class='left_btn back_btn' href="javascript:;"></a>
				<div class="bp_barrageswitch_item">
					<a href="javascript:;">
						<div></div>
					</a>
				</div>
				<a class='bp_resizebtn_item' href="javascript:;">
						<div></div>
				</a>
				<a class='right_btn share_btn' href="javascript:;"></a>
			</div>
			<div class="flipbook-viewport">
				<div class='flipbook_wrapper' pagecount='19'>
					<a class='flipbook_prevpage_btn' href="javascript:;"><span></span></a>

					<div class='flipbook'>
						<div depth="5" class="hard" style="background-image:url('../img/pages/1.jpg');">
							<link href="http://yb-test-book.qiniudn.com/pageTpl/IMAGE_TEXT/37/css/small_left.css" rel="stylesheet" type="text/css">
							<div class="container_activity_37_small_left">
								<div class="page_header_container">
									<div slottype="article" class="warp1">
										<div class="richShow" slottype="articleShow" textheight="40">
											<div class="main_title" slottype="richText" slotnum="0">
												雄关为头越
											</div>
										</div>
									</div>
								</div>
								<div class="photo0_container">
									<span id="imgMask0" imgwidth="1324" imgheight="907" slotnum="0" slottype="mask" class="photoframe_common_property photoframe0"></span>
									<img slottype="img" slotnum="0" class="img0" src="">
								</div>
								<div class="photo1_container">
									<span id="imgMask1" imgwidth="498" imgheight="334" slotnum="1" slottype="mask" class="photoframe_common_property photoframe1"></span>
									<img slottype="img" slotnum="1" class="img1" src="">
								</div>
								<div class="photo2_container">
									<span id="imgMask2" imgwidth="389" imgheight="261" slotnum="2" slottype="mask" class="photoframe_common_property photoframe2"></span>
									<img slottype="img" slotnum="2" class="img2" src="">
								</div>
								<div class="content_container">
									<strong>
									<div slottype="article" class="warp2">
										<div class="richShow" slottype="articleShow" textheight="30">
											<p></p>

											<p slottype="richText" slotnum="2" style="min-height:30px;"
											   placeholder="活动标题" mode="inline"></p>

											<p></p>
										</div>
									</div>
								</strong>

									<div slottype="article" class="warp3">
										<div class="richShow" slottype="articleShow" textheight="96">
											<p slottype="richText" slotnum="3" style="display:block;word-wrap:break-word;" placeholder="活动内容"></p>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div depth="5" class="hard front-side secondcover even" style="background-image:url('../img/pages/2.jpg');">
							<span class="depth"></span>
							<link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_left.css" rel="stylesheet" type="text/css">
							<div class="container_panoramic_02_small_left">
								<div slottype="article" class="warp">
									<div slottype="articleShow" textheight="62" class="richShow">
										<p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
										</p>
									</div>
								</div>
								<span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
								<img slottype="img" slotnum="1" src="" class="img1">
							</div>
						</div>
						<div class="hard fixed back-side thirdcover p19" style="background-image:url('../img/pages/tpl_small.jpg')">
							<span class="depth"></span>
							<link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_right.css" rel="stylesheet" type="text/css">
							<div class="container_panoramic_02_small_right">
								<div slottype="article" class="warp">
									<div slottype="articleShow" textheight="62" class="richShow">
										<p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
										</p>
									</div>
								</div>
								<span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
								<img slottype="img" slotnum="1" src="" class="img1">
							</div>
						</div>
						<div class="hard p20" style="background-image:url('../img/pages/tpl_small.jpg')"></div>
					</div>
					<a class='flipbook_nextpage_btn' href="javascript:;"><span></span></a>
				</div>
				<div class="bp_barrage_wrapper"></div>
				<div class="bp_paginator_item">
					<label>1</label>/<span>33</span></div>
			</div>

		</div>
		<div class="bp_portrait_wrapper">
			<div class="bp_bookinfo_item">本书一共有<span>XX</span>页，可上传<span>XX</span>张照片</div>
			<div class="bp_menu_wrapper">
				<ul>
					<li>
						<a href="javascript:;" class='active'>
							<div class="comment"></div>
							<p>评论(<span>123</span>)</p>
						</a>
					</li>
					<li>
						<a href="javascript:;">
							<div class="donate">赏</div>
							<p>赞助(<span>123</span>)</p>
						</a>
					</li>
					<li>
						<a href="javascript:;">
							<div class="praise"></div>
							<p>被赞(<span>123</span>)</p>
						</a>
					</li>
				</ul>
			</div>
			<div class="bp_iatab_wrapper">
				<div class="bp_comment_container">
					<span class="up_arrow"></span>
					<div class='bp_comment_wrapper'>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
						<table>
							<tr>
								<td>
									<div class="user_header"><img src="../img/m/user_default_head.png"></div>
								</td>
								<td>
									<div class="user_name"><span>username</span></div>
								</td>
								<td>
									<div class="commet_time"><span>2015-12-31</span></div>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="">
									<p>说些什么什么事什么什么事没什么事忙什么什么事...</p>
								</td>
							</tr>
						</table>
					</div>
					<div class="ybwechat_loading_item">
						<label><img class='loadingicon' src="../img/m/loading.gif">加载中...</label>
					</div>
				</div>
				<div class='bp_donatetab_wrapper'>
					<span class="up_arrow"></span>
					<div class='bp_donatedperson_wrapper'>
						<label>赞助过的人</label>
						<ul>
							<li>
								<img src="../img/m/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
							<li>
								<img src="../img/m/vote_result_avatar_100_100_00000.jpg">
								<span>小惆怅长岑长</span>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="bp_landscape_wrapper">
			<ul>
				<li class="comment">
					<a href="javascript:;">
						<div></div>
						<p>评论</p>
					</a>
				</li>
				<li class="praise">
					<a href="javascript:;">
						<div></div>
						<p>点赞</p>
					</a>
				</li>
				<li class="donate">
					<a href="javascript:;">
						<div>赏</div>
						<p>赞助</p>
					</a>
				</li>
				<li class="share">
					<a href="javascript:;">
						<div></div>
						<p>分享</p>
					</a>
				</li>
				<li class="bp_barrageswitch_item">
					<a href="javascript:;">
						<div></div>
						<p>弹幕</p>
					</a>
				</li>
				<li class="bp_resizebtn_item">
					<a href="javascript:;">
						<div></div>
						<p>最小化</p>
					</a>
				</li>
			</ul>
			<div class="chapter_slide">
				<a href="javascript:;">上一章</a>
				<a href="javascript:;">下一章</a>
			</div>
		</div>
		<div class='bp_donate_container'>
			<div class='bp_donate_wrapper'>
				<h5>做得不错，赞助鼓舞一下</h5>
				<div class='bp_donatepannel_wrapper'>
					<label>选择赞助金额：</label>
					<ul>
						<li>
							<a href="javascript:;">
								<span>1</span>
								<label>元</label>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<span>1</span>
								<label>元</label>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<span>1</span>
								<label>元</label>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<span>1</span>
								<label>元</label>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<span>1</span>
								<label>元</label>
							</a>
						</li>

						<li>
							<a href="javascript:;">
							其他金额</a>
						</li>
					</ul>
					<a class='donatebtn' href="javascript:;">立即赞助</a>
					<p>赞助无悔，概不退款</p>
				</div>

			</div>
		</div>
		<div class="bp_sendcomment_item">
			<div class="input_box">
				<input id="reply-write" type="text" placeholder="这里输入聊天内容" />
				<button type="button"><i></i></button>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="../assets/js/turn.js"></script>
	<script type="text/javascript" src="../assets/js/jquery.mobile.custom.min.js"></script>


	<script>
		var LOG = function() {
			return;
		};
		var LOG = alert;
		$(function() {
			//移动端滚动到底部加载插件
			$.extend({
				collideLoading: function(options) {
					options = $.extend({
						onScrollBottom: function() {}
					}, options)
					$(window).scroll(function() {
						var availHeight = $(window).height(),
							scrollTop = $(window).scrollTop(),
							docHeight = $(document).height();
						if (availHeight + scrollTop >= docHeight) {
							options.onScrollBottom();
						}
					});
				}
			});

			bookpreviewInit();
			interactionSwitcher();
			barrageSwitcher();
			collideLoading();
		});

		function collideLoading() {
			$.collideLoading({
				onScrollBottom: function() {
					var commentEl = '<table><tr><td><div class="user_header"><img src="../img/m/user_default_head.png"></div></td><td><div class="user_name"><span>username</span></div></td><td><div class="commet_time"><span>2015-12-31</span></div></td></tr><tr><td colspan="3" class=""><p>说些什么什么事什么什么事没什么事忙什么什么事...</p></td></tr></table>'
					$('.ybwechat_loading_item').show();
					setTimeout(function() {
						$('.bp_comment_wrapper').append(commentEl);
						$('.ybwechat_loading_item').hide();
					}, 3000);

				}
			});
		}

		function bookpreviewInit() {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				flipbook = $('.flipbook');
			// $('.flipbook').attr('currentpage',1)
			orientationSensor({
				portrait: function() {
					$('.flipbook-viewport').css({
						'height': windowWidth * 0.5
					});
					flipbook.attr('currentpage', 1);
					portraitHandler();
				},
				landscape: function() {
					$('.flipbook-viewport').css({
						'height': windowHeight
					});
					flipbook.attr('currentpage', 1);
					landscapeHandler();

				}
			});

			//监听翻转事件
			$(window).on("orientationchange", function(event) {
				orientationHandler(event, {
					portrait: function() {
						flipbook.turn("destroy");
						portraitHandler();
					},
					landscape: function() {
						flipbook.turn("destroy");
						landscapeHandler();
					}
				});
			});
			// 翻页，同时改变currentpage属性变量的值
			$('.flipbook_nextpage_btn').on('touchend', function() {
				flipbook.turn('next');
				flipbook.attr('currentpage', function() {
					return Number(flipbook.attr('currentpage')) + 2
				});
			});
			$('.flipbook_prevpage_btn').on('touchend', function() {
				flipbook.turn('previous');
				flipbook.attr('currentpage', function() {
					return Number(flipbook.attr('currentpage')) - 2
				});
			});
		}

		//屏幕方向探测器
		function orientationSensor(callback) {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height();
			if (typeof(callback) == 'undefined') {
				callback = {
					portrait: function() {},
					landscape: function() {}
				}
			} else {
				if (windowWidth < windowHeight) {
					return callback.portrait();
				} else {
					return callback.landscape();
				}
			}
		}
		//方向判断回调工具
		function orientationHandler(event, callback) {
			if (typeof(callback) == 'undefined') {
				callback = {
					portrait: function() {},
					landscape: function() {}
				}
			}
			switch (event.orientation) {
				case 'portrait':
					callback.portrait();
					console.log("方法改变为：" + event.orientation);
					break;
				case 'landscape':
					callback.landscape();
					console.log("方法改变为：" + event.orientation);
					break;
			}
			return callback;
		}

		// 竖屏控制器
		function portraitHandler(windowWidth, windowHeight) {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height();
			$('.flipbook-viewport').css({
				'height': windowWidth * 0.5
			});
			turnInit();
			turnToCurrentpage();
			$('.ybwechatheader_wrapper .title').show();
			$('.main_container').removeClass('viewmode_landscape').addClass('viewmode_portrait');
			$('.bp_donatepannel_wrapper ul li a').on('touchend', function() {
				$(this).parent().siblings().removeClass('active').end().addClass('active');
			});
		}
		// 横屏控制器
		function landscapeHandler(windowHeight) {
			var windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				flipbook = $('.flipbook');
			$('.flipbook-viewport').css({
				'height': windowHeight
			});
			turnInit();
			turnToCurrentpage();
			$('.ybwechatheader_wrapper .title').hide();
			$('.main_container').removeClass('viewmode_portrait').addClass('viewmode_landscape');
			$('.viewmode_landscape').on("touchend", function() {
				$('.ybwechatheader_wrapper').toggle();
			});
			$('.viewmode_landscape .bp_donate_wrapper').css({
				'margin-top': function() {
					return (windowHeight - $(this).height()) / 2 - windowHeight * 0.08
				}
			});
			//点击赞助按钮后弹出赞助框
			$('.bp_landscape_wrapper ul .donate').on('touchend', function() {
				$(this).find('a').addClass('active');
				$('.bp_donate_container').toggleClass('active').on('touchend', function() {
					$(document).on('touchend', function(e) {
						if ($(e.target).closest('.bp_donate_wrapper').length == 0 || $(e.target).closest('.donatebtn').length == 1) {
							$('.bp_donate_container, .bp_landscape_wrapper ul .donate a').removeClass('active');
						};
						$(this).unbind('touchend');
					});
					$('.bp_donatepannel_wrapper ul li a').on('touchend', function() {
						$(this).parent().siblings().removeClass('active').end().addClass('active');
					});
				});
			});
			//章节选择
			$('.chapter_slide a').on('touchend', function() {
				switch ($(this).index()) {
					case 0:
						flipbook.turn('previous');
						break;
					case 1:
						flipbook.turn('next');
						break;
				}
			});
			$('.viewmode_landscape .bp_landscape_wrapper .comment').on('touchend', function() {
				var commentInputEl = $('.bp_sendcomment_item');
				commentInputEl.toggle().on('touchend', function() {
					$(document).on('touchend', function(e) {
						if ($(e.target).closest('.bp_sendcomment_item').length == 0) {
							$('.bp_donate_container, .bp_landscape_wrapper ul .donate a').removeClass('active');
							commentInputEl.hide();
						};
					})
				});
			});
		}

		function turnToCurrentpage() {
			var flipbook = $('.flipbook');
			flipbook.turn('page', Number(flipbook.attr('currentpage')));
		}
		// 书册大小重定义
		function flipbookResize() {
			var zoom = 0,
				windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				originalWidth = 680,
				originalHeight = 960,
				portraitFactor = 0.7,
				landscapeFactor = 0.87;
			orientationSensor({
				portrait: function() {
					var zoom = windowWidth / (originalWidth * 2) * portraitFactor;
					$('.flipbook .page>div').css(sizeArguObj(zoom));
				},
				landscape: function() {
					var zoom = windowHeight * (landscapeFactor / originalHeight);
					$('.flipbook .page>div').css(sizeArguObj(zoom));
					console.log(zoom)
				}
			});

			// 尺寸设定集
			function sizeArguObj(zoom) {
				return {
					'-ms-zoom': zoom,
					'-webkit-transform': 'scale(' + zoom + ')',
					'-webkit-transform-origin': 'left top',
					'-moz-transform': 'scale(' + zoom + ')',
					'-moz-transform-origin': 'left center'
				}
			}
		}

		function turnInit() {
			var bookIdx = 2,
				windowWidth = $(window).width(),
				windowHeight = $(window).height(),
				flipbook = $('.flipbook'),
				zoom = 0,
				flipbookWidth = orientationSensor({
					portrait: function() {
						return 1360 * (windowWidth / 1360) * 0.7;
					},
					landscape: function() {
						return 1360 * (windowHeight / 964) * 0.87;
					}
				});
			$('.page-wrapper .page').addClass('hard');
			flipbook.addClass('animated');
			flipbook.turn({
				width: flipbookWidth,
				height: flipbookWidth * 0.7,
				acceleration: !isChrome(),
				autoCenter: true,
				gradients: true,
				duration: 1000,
				pages: bookLength(),
				when: {
					turning: function(e, page, view) {
						var currentPage = flipbook.turn('page'),
							pages = bookLength();
						disableControls(page);
						if (currentPage > 3 && currentPage < pages - 3) {
							if (page == 1) {
								flipbook.turn('page', 2).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							} else if (page == pages) {
								flipbook.turn('page', pages - 1).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							}
						} else if (page > 3 && page < pages - 3) {
							if (currentPage == 1) {
								flipbook.turn('page', 2).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							} else if (currentPage == pages) {
								flipbook.turn('page', pages - 1).turn('stop').turn('page', page);
								e.preventDefault();
								return;
							}
						}

						if (page >= 2) {
							$('.flipbook_wrapper .p2').addClass('fixed');
						} else {
							$('.flipbook_wrapper .p2').removeClass('fixed');
						}
						if (page < bookLength()) {
							$('.flipbook_wrapper .p' + (bookLength() - 1)).addClass('fixed');
						} else {
							$('.flipbook_wrapper .p' + (bookLength() - 1)).removeClass('fixed');
						}
					},
					turned: function(e, page, view) {
						disableControls(page);
					},
					start: function(e, pageObj) {},
					end: function(e, pageObj) {
						flipbookResize();
						$('.bp_paginator_item label').text(flipbook.turn('page'));
					},
					missing: function(e, pages) {
						for (var i = 0; i < pages.length; i++) {
							addPage(bookIdx, pages[i], $(this), flipbookWidth);
						}
					}
				}
			});
			$('.flipbook_wrapper').css({
				width: flipbookWidth
			});

			setTimeout(function() {
				flipbookResize();
			}, 50)

			function isChrome() {
				return navigator.userAgent.indexOf('Chrome') != -1;
			}

			function bookLength() {
				var length = $('.flipbook_wrapper').attr('pagecount');
				if (length % 2 != 0) {
					return parseInt(length) + 1;
				} else {
					return length;
				}
			}

			function addPage(bookIdx, page, book, flipbookWidth) {
				var pages = book.turn('pages');
				if (!book.turn('hasPage', page)) {
					var element = $('<div />', {
						'class': 'own-size',
						css: {
							width: flipbookWidth / 2,
							height: flipbookWidth * 0.7
						}
					}).html('<div class="loader"></div>');
					if (book.turn('addPage', element, page)) {
						loadPage(bookIdx, page);
					}
				}

				function loadPage(bookIdx, page) {
					$.ajax({
						url: '../flipbookpages/' + bookIdx + '/page' + page + '.html'
					}).done(function(pageHtml) {
						$('.flipbook .p' + page).html(pageHtml.replace('yb3.0/flipbookpages/', ''));
					});
				}
			}

			function disableControls(page) {
				var prevBtn = $('.flipbook_prevpage_btn'),
					nextBtn = $('.flipbook_nextpage_btn')
				if (page == 1) {
					prevBtn.hide();
					nextBtn.show();
				} else if (page == flipbook.turn('pages')) {
					prevBtn.show();
					nextBtn.hide();
				} else {
					prevBtn.show();
					nextBtn.show();
				}
			}
		}

		/*
		 * 评论赞tab切换
		 * */
		function interactionSwitcher() {
			$('.bp_menu_wrapper li a').on('touchend', function() {
				var $this = $(this),
					index = $this.parent().index(),
					thisEl = $('.bp_iatab_wrapper>div').eq(index);
				$this.closest('li').siblings('li').find('a').removeClass('active');
				$this.addClass('active');
				console.log(index)
				thisEl.show().siblings('div').hide();
				switch (index) {
					case 1:
						chooseanddonateEl=$('.bp_donatepannel_wrapper')
						thisEl.append(chooseanddonateEl);
						break;
				}
			});
		}

		/*
		 * 弹幕开关
		 * */
		function barrageSwitcher() {
			var commentJSON = {
				"commentArr": [{
					"comment": "感谢你，啦啦啦"
				}, {
					"comment": "嗯嗯嗯爱爱爱爱啊"
				}, {
					"comment": "我的天呀"
				}, {
					"comment": "good good good "
				}, {
					"comment": "O(∩_∩)O哈哈哈~"
				}, {
					"comment": "嗯嗯嗯爱爱爱爱啊"
				}, {
					"comment": "我的天呀"
				}, {
					"comment": "good good good "
				}, {
					"comment": "嗯嗯嗯爱爱爱爱啊"
				}, {
					"comment": "我的天呀"
				}, {
					"comment": "good good good "
				}, {
					"comment": "11111"
				}, {
					"comment": "22222"
				}, {
					"comment": "33333"
				}]
			}
			$(".bp_barrageswitch_item").on('touchend', function() {
				var switcher = $(this).find('a');
				if (!switcher.hasClass('active')) {
					switcher.addClass('active')
					$(".bp_barrage_wrapper").show();
					var commentEl = new Array();
					for (var i = 0; i < commentJSON.commentArr.length; i++) {
						commentEl[i] = commentJSON.commentArr[i];
					};
					//把数据载入好了，就传给barrage()函数就直接发弹幕了
					barrage(commentEl);
				} else {
					$(".bp_barrage_wrapper").hide().find('div').remove();
					switcher.removeClass('active')
				}
			})
		}

		$('.bp_sendcomment_item button').on('touchend', function() {
			var comment = $(this).prev().val();
			if ($.trim(comment) == "") {
				alert("亲，请输入你的想说的话！");
				return false;
			} else {
				barrage(comment);
			}
		});

		function barrage(comment) {
			console.log(comment);
			var commentLength = 1;
			$('.bp_barrage_wrapper').show();
			if (typeof(comment) == 'object') {
				var commentLength = comment.length;
				for (var i = 0; i < commentLength; i++) {
					loadandfire(comment[i].comment);
				}
			} else {
				var commentEl = new Array();
				commentEl[0] = comment;
				loadandfire(commentEl[0]);
			}

			function loadandfire(comment) {
				var windowWidth = $(window).width(),
					windowHeight = $(window).height();
				//拼装弹幕字符元素
				comment = $('<div></div>').addClass('barrage').css({
					'position': 'absolute',
					'left': windowWidth + 100,
					'top': windowWidth * 0.5 * Math.random(1),
					'color': getReandomColor(),
					'font-size': getReandomFontSize()
				}).html('<p>' + comment + '</p>');

				$(".bp_barrage_wrapper").append(comment);
				setTimeout(function() {
					animateBarrage(windowWidth, comment);
				}, 100);
			}

			//对弹幕元素添加动画
			function animateBarrage(windowWidth, commentEl) {
				commentEl.addClass('active').css({
					'left': -windowWidth,
					'-webkit-transition': 'left ' + getRandomTime() + 's',
					'-moz-transition': 'left ' + getRandomTime() + 's'
				});
				console.log(getRandomTime());
				commentEl.removeClass('active');
			}
		}

		//随机获取颜色值
		function getReandomColor() {
			return '#' + (function(h) {
				return new Array(7 - h.length).join("0") + h
			})((Math.random() * 0x1000000 << 0).toString(16));
		}
		//随机获取字号
		function getReandomFontSize() {
			return (function() {
				return Math.floor(Math.random() * (45 - 12 + 1) + 12) + 'px';
			});
		}

		function getRandomTime(config) {
			config = $.extend({
				range: 20,
				offset: 15
			}, config);
			return Math.random(1) * config.range + config.offset;
		}
	</script>
</body>

</html>
