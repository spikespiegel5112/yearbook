<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<!-- build:css ../css/m.all.min.css -->
	<link rel="stylesheet" type="text/css" href="../css/m_reset.css">
	<link rel="stylesheet" type="text/css" href="../css/m_common.css">
	<!-- endbuild -->
	<link rel="stylesheet" href="http://at.alicdn.com/t/font_1459154853_012007.css">
	<title>照片查看</title>
</head>

<body>
	<div class='main_conatainer'>
		<div class='common_editphoto_wrapper'>
			<div class='common_epeditarea_wrapper'>
				<img class='common_epimage_item' src="../img/m/banner/yb_banner_activity_3_00000.jpg">
			</div>
			<div class='common_eptools_wrapper'>
				<div class='common_epzomming_wrapper'>
					<a class='zoomout' href="javascript:;">-</a>
					<div class='common_epscrollbar_item'>
						<span></span>
						<label></label>
					</div>
					<a class='zoomin' href="javascript:;">+</a>
				</div>
				<ul class='common_eptoolbar_wrapper'>
					<li class='turnright'><a href="javascript:;">turn right</a></li>
					<li class='turnleft'><a href="javascript:;">turn left</a></li>
					<li class='reset'><a href="javascript:;">reset</a></li>
				</ul>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
<!-- build:js js/all.js -->
<script type="text/javascript" src="../js/m_base.js"></script>
<!-- endbuild -->
<script type="text/javascript">
$(function() {

	$('.common_editphoto_wrapper').css('height',568);
	$('.common_epeditarea_wrapper').align();
	$('.common_epimage_item').align({
		container:'.common_epeditarea_wrapper'
	});
	$.remResizing({
		fontsize: 20
	})
	var editphoto = function(options) {
		var options = $.extend({
				scale: 0.5,
				rotate: 0
			}, options),
			image = $('.common_epimage_item').css('transition', 'transform 0.5s'),
			trBtn = $(".common_eptoolbar_wrapper .turnright a"),
			tlBtn = $(".common_eptoolbar_wrapper .turnleft a"),
			zoominBtn = $('.common_epzomming_wrapper .zoomin'),
			zoomoutBtn = $('.common_epzomming_wrapper .zoomout'),
			resetbtn = $('.common_eptoolbar_wrapper .reset'),
			epscrollbar = $('.common_epscrollbar_item'),
			epscrollbarWidth = epscrollbar.find('label').width(),
			zoomingSlider = epscrollbar.find('span'),
			marginleft = 0,
			startPosX = 0,
			startPosY = 0,
			sliderPosX = zoomingSlider.offset().left,
			marginleft = epscrollbarWidth / 2;

		zoomingSlider.css('margin-left', marginleft);

		trBtn.on('touchend', function() {
			image.css(turning('right'));
		});
		tlBtn.on('touchend', function() {
			image.css(turning('left'));
		});
		zoomoutBtn.on('touchend', function() {
			marginleft -= epscrollbarWidth / 2 / 5
			if (marginleft <= 0) {
				marginleft = 0;
			}
			options.scale = marginleft / epscrollbarWidth;
			image.css(cssSettings(options));
			zoomingSlider.css('margin-left', marginleft);
		});
		zoominBtn.on('touchend', function() {
			marginleft += epscrollbarWidth / 2 / 5;
			if (marginleft >= epscrollbarWidth - 10) {
				marginleft = epscrollbarWidth - 10;
			}
			options.scale = marginleft / epscrollbarWidth;
			image.css(cssSettings(options));
			zoomingSlider.css('margin-left', marginleft);
		});
		resetbtn.on('touchend', function(){
			options.scale=0.5;
			options.rotate=0;
			image.css(cssSettings(options));
			zoomingSlider.css('margin-left', epscrollbarWidth / 2);
		})
		document.addEventListener('touchstart', eventHandler, false);
		document.addEventListener('touchmove', eventHandler, false);

		function eventHandler(e) {
			e.preventDefault();
			var touch = e.touches[0];

			if ($(e.target).closest(zoomingSlider).length > 0) {
				switch (e.type) {
					case 'touchstart':
						startPosX = touch.pageX;
						console.log(startPosX);
						break;
					case 'touchmove':
						var movingPosX = touch.pageX;
						marginleft = movingPosX - sliderPosX
						if (marginleft <= 0) {
							marginleft = 0;
						} else if (marginleft > epscrollbarWidth - 10) {
							marginleft = epscrollbarWidth - 10
						} else {
							zoomingSlider.css('margin-left', marginleft);
							options.scale = marginleft / epscrollbarWidth;
							image.css(cssSettings(options));
						}
						break;
				}
			}
		}

		function turning(direction) {
			switch (direction) {
				case 'right':
					options.rotate += 90;
					break;
				case 'left':
					options.rotate -= 90;
					break;
			}
			return cssSettings(options)
		}

		function cssSettings(options) {
			var options = $.extend({
				scale: 0,
				rotate: 0
			}, options),
			cssObj={
				'transform': 'scale(' + options.scale * 2 + ') rotate(' + options.rotate + 'deg)'
			}
			console.log(cssObj)
			return cssObj;
		}
	}()
})
</script>

</html>
