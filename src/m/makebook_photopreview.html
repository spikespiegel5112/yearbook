<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<!-- build:css ../css/m.all.min.css -->
	<link rel="stylesheet" type="text/css" href="../css/m_reset.css">
	<link rel="stylesheet" type="text/css" href="../css/m_common.css">
	<link rel="stylesheet" type="text/css" href="../css/m_makebook.css">
	<!-- endbuild -->
	<link rel="stylesheet" href="http://at.alicdn.com/t/font_1460347319_6012216.css">
	<title>照片修改</title>
</head>

<body>
	<div class='makebook_editphoto_conatainer viewmode_portrait'>
		<div class="ybwechatheader_wrapper">
			<a class='left_btn back_btn' href="javascript:;"><span class="ybiconfont ybicon-backward2"></span></a>
			<div class="bp_barrageswitch_item">
				<a href="javascript:;">
					<div></div>
				</a>
			</div>
			<p>照片修改</p>
			<a class='action_btn right_btn' href="javascript:;">保存</a>
		</div>
		<div class='makebook_editphoto_wrapper'>
			<div class='makebook_epeditarea_wrapper'>
				<img class='makebook_epimage_item' src="../img/m/banner/yb_banner_activity_3_00000.jpg">
			</div>
			<div class='makebook_eptools_wrapper'>
				<div class='makebook_epzomming_wrapper'>
					<!-- <a class='zoomout' href="javascript:;">-</a> -->
					<div class='makebook_epscrollbar_item'>
						<span></span>
						<label></label>
					</div>
					<!-- <a class='zoomin' href="javascript:;">+</a> -->
				</div>
				<ul class='makebook_eptoolbar_wrapper'>
					<li class='originalsize'>
						<a class='ybiconfont ybicon-originalsize' href="javascript:;"></a>
					</li>
					<li class='freesize'>
						<a class='ybiconfont ybicon-freesize' href="javascript:;"></a>
					</li>
					<li class='turnleft'>
						<a class='ybiconfont ybicon-anticlockwise' href="javascript:;"></a>
					</li>
					<li class='turnright'>
						<a class='ybiconfont ybicon-clockwise' href="javascript:;"></a>
					</li>
					<li class='picture'>
						<a class='ybiconfont ybicon-picture' href="javascript:;"></a>
					</li>
					<li class='trash'>
						<a class='ybiconfont ybicon-trash2' href="javascript:;"></a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
<!-- build:js js/all.js -->
<script type="text/javascript" src="../js/base.js"></script>
<!-- endbuild -->
<script type="text/javascript">
$(function() {
	$.remResizing({
		fontsize: 20
	})

	var editphoto = function() {
		var options = $.extend({
				scale: 1,
				rotate: 0,
				left: 0,
				top: 0
			}, options),
			windowWidth = $(window).width(),
			windowHeight = $(window).height(),
			image = $('.makebook_epimage_item'),
			editphotoBg = $('.makebook_editphoto_wrapper'),
			photoframe = $('.makebook_epeditarea_wrapper'),
			trBtn = $(".makebook_eptoolbar_wrapper .turnright a"),
			tlBtn = $(".makebook_eptoolbar_wrapper .turnleft a"),
			zoominBtn = $('.makebook_epzomming_wrapper .zoomin'),
			zoomoutBtn = $('.makebook_epzomming_wrapper .zoomout'),
			reScaleBtn = $('.makebook_eptoolbar_wrapper .rescale'),
			rePositionBtn = $('.makebook_eptoolbar_wrapper .reposition'),
			fitwidthBtn = $('.makebook_eptoolbar_wrapper .fitwidth'),
			fitheightBtn = $('.makebook_eptoolbar_wrapper .fitheight'),
			originalsizeBtn = $('.makebook_eptoolbar_wrapper .originalsize'),
			epscrollbar = $('.makebook_epscrollbar_item'),
			epscrollbarWidth = epscrollbar.find('label').width(),
			zoomingSlider = epscrollbar.find('span'),
			photoImg = $('.makebook_epimage_item'),
			imgRatio = 1.5,
			startPosX = 0,
			startPosY = 0,
			endPosX = 0,
			offsetPosX = 0,
			offsetposY = 0,
			sliderPosX = zoomingSlider.offset().left,
			marginleft = epscrollbarWidth / 2;

		var init = function() {
			image.css('transition', 'transform 0.5s');
			zoomingSlider.css('margin-left', marginleft);
			editphotoBg.css('height', windowHeight);
			photoImg.css(options);
			if (imgRatio > 1) {
				photoframe.css('height', (windowWidth * 0.9) / imgRatio);
			} else if (imgRatio > 0 && imgRatio < 1) {
				photoframe.css('width', windowHeight * 0.9 * imgRatio + '%')
			}
			//先确定相框高度后再对图片进行居中操作
			photoframe.align();
			image.align({
				container: '.makebook_epeditarea_wrapper'
			});
		}();
		originalsizeBtn.on('touchend', function() {
			image.css(cssSettings({
				'scale': 1
			}));
			zoomingSlider.css('margin-left', epscrollbarWidth / 2);
		});
		//向右转
		trBtn.on('touchend', function() {
			options.rotate += 90;
			image.css(cssSettings(options));
		});
		//向左转
		tlBtn.on('touchend', function() {
			options.rotate -= 90;
			image.css(cssSettings(options));
		});
		//放大
		zoomoutBtn.on('touchend', function() {
			marginleft -= epscrollbarWidth / 2 / 5
			if (marginleft <= 0) {
				marginleft = 0;
			}
			image.css(cssSettings({
				'scale': Number(marginleft / epscrollbarWidth) * 2
			}));
			zoomingSlider.css('margin-left', marginleft);
		});
		//缩小
		zoominBtn.on('touchend', function() {
			marginleft += epscrollbarWidth / 2 / 5;
			if (marginleft >= epscrollbarWidth - 10) {
				marginleft = epscrollbarWidth - 10;
			}
			image.css(cssSettings({
				'scale': Number(marginleft / epscrollbarWidth) * 2
			}));
			zoomingSlider.css('margin-left', marginleft);
		});
		//重新归位
		rePositionBtn.on('touchend', function() {
			options = $.extend({
				left: 0,
				top: 0
			}, options)
			image.css(options);
		});
		fitwidthBtn.on('touchend', function() {
			options.scale = 0.5;
			zoomingSlider.css('margin-left', epscrollbarWidth / 2);
		})
		document.addEventListener('touchstart', eventHandler, false);
		document.addEventListener('touchmove', eventHandler, false);

		function eventHandler(e, options) {
			e.preventDefault;
			var touch = e.touches[0];
			if ($(e.target).closest(zoomingSlider).length > 0) {
				var movingPosX = touch.pageX;
				marginleft = movingPosX - sliderPosX;
				if (marginleft <= 0) {
					marginleft = 0;
				} else if (marginleft > epscrollbarWidth - 10) {
					marginleft = epscrollbarWidth - 10
				} else {
					zoomingSlider.css('margin-left', marginleft);
					options = {
						scale: Number(marginleft / epscrollbarWidth) * 2
					}
					console.log(options)
					image.css(cssSettings(options));
				}
			} else if ($(e.target).closest(photoImg).length > 0) {
				switch (e.type) {
					case 'touchstart':
						startPosX = touch.pageX,
						startPosY = touch.pageY,
						photoImgLeft = Number(photoImg.css('left').replace('px', '')),
						photoImgTop = Number(photoImg.css('top').replace('px', ''))
						console.log(photoImgLeft)
						break;
					case 'touchmove':
						e.preventDefault;
						endPosX = touch.pageX,
						endPosY = touch.pageY,
						offsetPosX = endPosX - startPosX,
						offsetPosY = endPosY - startPosY;
						options = $.extend({
							position: 'relative',
							left: offsetPosX + photoImgLeft,
							top: offsetPosY + photoImgTop
						}, options);
						photoImg.css(options)
						console.log('photoImgLeft ' + offsetPosX + photoImgLeft)
						break;
				}
			}
		}
		//某些必须集合多个参数的样式的设置模式
		function cssSettings(config) {
			options = $.extend(options, config);
			var cssObj = options;
			if (options.rotate || options.scale) {
				var returncss = {
					'transform': 'rotate(' + options.rotate + 'deg) scale(' + options.scale + ')'
				}
				console.log(options)
				return returncss;
			};
		}
	}()
})
</script>

</html>