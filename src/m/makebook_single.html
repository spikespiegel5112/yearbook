<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<!-- build:css ../css/m.all.min.css -->
	<link rel="stylesheet" type="text/css" href="../css/m_reset.css">
	<link rel="stylesheet" type="text/css" href="../css/m_common.css">
	<link rel="stylesheet" type="text/css" href="../css/m_makebook.css">
	<!-- endbuild -->
	<link rel="stylesheet" href="../assets/css/font-awesome.css">
	<link rel="stylesheet" href="http://at.alicdn.com/t/font_1460348402_2979512.css">
	<link rel="stylesheet" href="../assets/css/swiper.min.css">
	<title>3.12 制作书册-单页编辑</title>
</head>

<body>
	<div class='main_conatainer edit_book_con'><!--单页书册编辑class:edit_book-->
        <div class="ybwechatheader_wrapper">
            <a class='left_btn left_angle' href='javascript:;'>
                <span class="ybiconfont ybicon-backward3"></span>
            </a>
            <p>《<span>时光不老我们不散</span>》<span class="swiper-pagination">P1-P2</span></p>
            <a class="right_btn print" href="javascript:;">打印</a>
        </div>
        <div class="make_book_wrap">
            <div class="single_mode">
                <ul class="swiper-wrapper">
                    <li class="swiper-slide">
                        <div class="tpl cover">
                            <div class="double_con">
                                <div class="page left">
                                    <img src="../img/m/default/cover_left.jpg" style="min-width: 100%;height: 100%;">
                                </div>
                                <div class="page right">
                                    <img src="../img/m/default/cover_right.jpg" style="min-width: 100%;height: 100%;">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="swiper-slide">
                        <div class="tpl double">
                            <div class="double_con">
                                <div class="page left">
                                    <link href="http://yb-test-book.qiniudn.com/pageTpl/IMAGE_TEXT/37/css/small_left.css" rel="stylesheet" type="text/css">
                                    <div class="container_activity_37_small_left">
                                        <div class="page_header_container">
                                            <div slottype="article" class="warp1">
                                                <div class="richShow" slottype="articleShow" textheight="40">
                                                    <div class="main_title" slottype="richText" slotnum="0">
                                                        雄关为头越
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="photo0_container">
                                            <span id="imgMask0" imgwidth="1324" imgheight="907" slotnum="0" slottype="mask" class="photoframe_common_property photoframe0"></span>
                                            <img slottype="img" slotnum="0" class="uploadImg1" src="../img/m/makebook/upload_photo.png">
                                        </div>
                                        <div class="photo1_container">
                                            <span id="imgMask1" imgwidth="498" imgheight="334" slotnum="1" slottype="mask" class="photoframe_common_property photoframe1"></span>
                                            <img slottype="img" slotnum="1" class="uploadImg1" src="../img/m/makebook/upload_photo.png">
                                        </div>
                                        <div class="photo2_container">
                                            <span id="imgMask2" imgwidth="389" imgheight="261" slotnum="2" slottype="mask" class="photoframe_common_property photoframe2"></span>
                                            <img slottype="img" slotnum="2" class="uploadImg1" src="../img/m/makebook/upload_photo.png">
                                        </div>
                                        <div class="content_container">
                                            <strong>
                                                <div slottype="article" class="warp2">
                                                    <div class="richShow" slottype="articleShow" textheight="30">
                                                        <p></p>
                                                        <p slottype="richText" slotnum="2" style="min-height:30px;" placeholder="活动标题" mode="inline"></p>
                                                        <p></p>
                                                    </div>
                                                </div>
                                            </strong>

                                            <div slottype="article" class="warp3">
                                                <div class="richShow" slottype="articleShow" textheight="96">
                                                    <p slottype="richText" slotnum="3" style="display:block;word-wrap:break-word;" placeholder="活动内容"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="page right">
                                    <link href="http://yb-test-book.qiniudn.com/pageTpl/IMAGE_TEXT/37/css/small_left.css" rel="stylesheet" type="text/css">
                                    <div class="container_activity_37_small_left">
                                        <div class="page_header_container">
                                            <div slottype="article" class="warp1">
                                                <div class="richShow" slottype="articleShow" textheight="40">
                                                    <div class="main_title" slottype="richText" slotnum="0">
                                                        雄关为头越
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="photo0_container">
                                            <span id="imgMask0" imgwidth="1324" imgheight="907" slotnum="0" slottype="mask" class="photoframe_common_property photoframe0"></span>
                                            <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                        </div>
                                        <div class="photo1_container">
                                            <span id="imgMask1" imgwidth="498" imgheight="334" slotnum="1" slottype="mask" class="photoframe_common_property photoframe1"></span>
                                            <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                        </div>
                                        <div class="photo2_container">
                                            <span id="imgMask2" imgwidth="389" imgheight="261" slotnum="2" slottype="mask" class="photoframe_common_property photoframe2"></span>
                                            <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                        </div>
                                        <div class="content_container">
                                            <strong>
                                                <div slottype="article" class="warp2">
                                                    <div class="richShow" slottype="articleShow" textheight="30">
                                                        <p></p>
                                                        <p slottype="richText" slotnum="2" style="min-height:30px;" placeholder="活动标题" mode="inline"></p>
                                                        <p></p>
                                                    </div>
                                                </div>
                                            </strong>

                                            <div slottype="article" class="warp3">
                                                <div class="richShow" slottype="articleShow" textheight="96">
                                                    <p slottype="richText" slotnum="3" style="display:block;word-wrap:break-word;" placeholder="活动内容"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="swiper-slide">
                        <div class="tpl double">
                            <div class="double_con">
                                <div class="page left">
                                    <link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_left.css" rel="stylesheet" type="text/css">
                                    <div class="container_panoramic_02_small_left">
                                        <div slottype="article" class="warp">
                                            <div slottype="articleShow" textheight="62" class="richShow">
                                                <p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
                                                </p>
                                            </div>
                                        </div>
                                        <span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
                                        <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                    </div>
                                </div>
                                <div class="page right">
                                    <link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_right.css" rel="stylesheet" type="text/css">
                                    <div class="container_panoramic_02_small_right">
                                        <div slottype="article" class="warp">
                                            <div slottype="articleShow" textheight="62" class="richShow">
                                                <p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
                                                </p>
                                            </div>
                                        </div>
                                        <span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
                                        <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="swiper-slide">
                        <div class="tpl double">
                            <div class="double_con">
                                <div class="page left">
                                    <link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_left.css" rel="stylesheet" type="text/css">
                                    <div class="container_panoramic_02_small_left">
                                        <div slottype="article" class="warp">
                                            <div slottype="articleShow" textheight="62" class="richShow">
                                                <p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
                                                </p>
                                            </div>
                                        </div>
                                        <span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
                                        <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                    </div>
                                </div>
                                <div class="page right">
                                    <link href="http://yb-test-book.qiniudn.com/pageTpl/PANO/2/css/small_right.css" rel="stylesheet" type="text/css">
                                    <div class="container_panoramic_02_small_right">
                                        <div slottype="article" class="warp">
                                            <div slottype="articleShow" textheight="62" class="richShow">
                                                <p placeholder="学校班级.." slottype="richText" slotnum="4" mode="inline" class="graduate-po">
                                                </p>
                                            </div>
                                        </div>
                                        <span id="imgMask1" imgwidth="3120" imgheight="1700" slotnum="1" slottype="mask" class="photoframe1" style="text-align:center;vertical-align:middle;display: block;"></span>
                                        <img slottype="img" slotnum="1" src="../img/m/makebook/upload_photo.png" class="uploadImg1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="swiper-button-prev swiper-button-white"></div>
                <div class="swiper-button-next swiper-button-white"></div>
            </div>
        </div>
	</div>
<!--选择上传路径-->
<div class="cm_bottom_menu">
    <div class="options">
        <ul>
            <li><input class="input_file" type="file" value=""><a class="selected" href="javascript:;">从手机上传</a></li>
            <li><a class="" href="javascript:;">从忆尔像册上传</a></li>
            <li><a class="" href="javascript:;">取消上传</a></li>
        </ul>
    </div>
</div>
<!--加载进度-->
<div class="load_progress_wrap">
    <div class="load" role="button" aria-label="Upload file"></div>
    <a class="reload" href="javascript:;">
        <span class="icon-refresh"></span>
        <p>重新加载</p>
    </a>
</div>
</body>
<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../assets/js/swiper.jquery.min.js"></script>
<!--弹性加载依赖-->
<script src="../assets/js/tweenMax.min.js"></script>
<script src="../assets/js/elastic-progress.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
        remResizing();
        initEditBookWrap();
        popBottomMenu('.uploadImg1');
        loadBookProgress();
    });

    function loadBookProgress(){
        var progress = new ElasticProgress($('.load_progress_wrap .load'),{
            buttonSize: 60,
            fontFamily: "Montserrat",
            width: 240,
            labelHeight:35,
            barHeight: 6,
            colorBg: "#fff",
            colorFg: "#60e550",
            textFail: "失败",
            textComplete: "完成",
            arrowHangOnFail: true
        });

        //开始加载
        progress.open();

        //加载中
        progress.onOpen(function(){
            //假进度加载
            fakeLoading(progress,2);
            //真实进度Methods：setValue,getValue
            //progress.setValue(.5);
            $('.load #head polygon').attr('style','fill: rgb(255, 255, 255);');
            $('.load #line rect').attr('style','fill: rgb(255, 255, 255);');
            $('.load #label text').attr('style','fill: rgb(51, 51, 51);');
        });

        //加载完成
        progress.onComplete(function() {
            TweenMax.delayedCall(0.5, function() {
                progress.close();
                $('.load_progress_wrap').fadeOut();
            })
        });

        //加载失败
        progress.onFail(function() {
            progress.close();
            TweenMax.delayedCall(3, function() {
                $('.reload').show().click(function(){
                    progress.open();
                    $(this).hide();
                });
            });
        });

        //进度值改变 或取消
        progress.onChange(function(){});
        progress.onCancel (function(){});
    }

    //设置加载百分比
    function fakeLoading($obj, speed, failAt) {
        if (typeof speed == "undefined") speed = 2;
        if (typeof failAt == "undefined") failAt = -1;
        var v = 0;
        var l = function() {
            if (failAt > -1) {
                if (v >= failAt) {
                    if (typeof $obj.jquery != "undefined") {
                        $obj.ElasticProgress("fail");
                    } else {
                        $obj.fail();
                    }
                    return;
                }
            }
            v += Math.pow(Math.random(), 2) * 0.1 * speed;

            if (typeof $obj.jquery != "undefined") {
                $obj.ElasticProgress("setValue", v);
            } else {
                $obj.setValue(v);
            }
            if (v < 1) {
                TweenMax.delayedCall(0.05 + (Math.random() * 0.14), l)
            }
        };
        l();
    }

    function initEditBookWrap(){
        //init swiper slide
        var swiper = new Swiper('.single_mode', {
            loop:false,
            // 如果需要前进后退按钮
            nextButton: '.swiper-button-next',
            prevButton: '.swiper-button-prev',
            pagination : '.swiper-pagination',
            paginationType : 'custom',
            paginationCustomRender: function (swiper, current, total) {
                return current + ' / ' + total;
            }
        });

        //编辑图片
        $('.uploadImg1').each(function(){
            //进度遮罩
            $(this).before("<div class='loadPercent'><span>完成：<b>80%</b></span></div>");

            //点我编辑
            $(this).before("<p class='clickEdit'><a href='javascript:;'>点我编辑</a></p>");
            $(this).wrap("<div class='uploadImg' style='position: absolute;width: 100%;height: 100%;'></div>")
        });


       /* $slot.find('.uploadImg1').load(function(){

            var innerUploadImgCss = $slot.attr('innerUploadImgCss');
            var imgW = $slot.find('.uploadImg1').width();
            var imgH = $slot.find('.uploadImg1').height();
            var uW = (slotW - imgW)/2 < 0 ? 0 : (slotW - imgW)/2;
            var uH = (slotH - imgH)/2 < 0 ? 0 : (slotH - imgH)/2;
            $slot.find('.pixel_less').css({left : uW + "px"});
            if (innerUploadImgCss != "" && typeof innerUploadImgCss != "undefined") {
                var imgCss = $slot.find('.uploadImg1').attr('style') + innerUploadImgCss;
                $slot.find('.uploadImg1').attr('style', imgCss);
            } else {
                $slot.find('.uploadImg1').css({left : uW + "px", top : uH + "px"});
            }
        });*/
    }

    function popBottomMenu(selector){
        $(selector).click(function(){
            var optionsContainer = $('.cm_bottom_menu');
            optionsContainer.fadeIn('fast').find('.options').addClass('active').removeClass('hide');

            //关闭
            optionsContainer.find('a').click(function(e){
                optionsContainer.find('a').each(function (e) {
                    $(this).removeClass('selected');
                });
                $(this).addClass('selected');
                optionsContainer.find('.options').addClass('hide').removeClass('active');
                optionsContainer.fadeOut('fast');
            })

        });
    }

    function remResizing(options) {
        options = $.extend({
            fontsize: 16,
            minwidth: 320,
            maxwidth: 0,
            aligncenter: true
        }, options);
        var htmlEl = $('html'),
                bodyEl = $('body'),
                windowWidth = $(window).width();
        sizeConstraint();
        $(window).resize(function() {
            sizeConstraint();
        });

        function sizeConstraint() {
            var windowWidth = $(window).width(),
                    windowHeight = $(window).height(),
                    factor = 0,
                    zoom = 0,
                    originalWidth = 680,
                    originalHeight = 964,
                    portraitFactor = 0.7,
                    landscapeFactor = 0.843;
            orientationSensor({
                portrait: function() {
                    var center = windowWidth/2 + 'px ' +windowWidth/2+'px';
                        bodyEl.css({
                        'width': windowHeight,
                        'height': windowWidth,
                        'transform': 'rotate(90deg)',
                        '-webkit-transform':'rotate(90deg)',
                        'transform-origin':center
                    });
                    factor = windowWidth / options.minwidth;
                    htmlEl.css('font-size', options.fontsize * factor);

                    //竖屏缩放书册内容
                    var zoom = windowWidth * (landscapeFactor / originalHeight);
                    $('.tpl .page >div').css(sizeArguObj(zoom));
                },
                landscape: function() {
                    bodyEl.css({
                        'width': windowWidth,
                        'height': windowHeight,
                        'transform': 'rotate(0)',
                        '-webkit-transform':'rotate(0)',
                        'transform-origin': 'center center'
                    });
                    factor = windowHeight / options.minwidth;
                    htmlEl.css('font-size', options.fontsize * factor);

                    //横屏缩放书册内容
                    var zoom = windowHeight * (landscapeFactor / originalHeight);
                    $('.tpl .page >div').css(sizeArguObj(zoom));
                }
            });

        }
    }

    //屏幕方向探测器
    function orientationSensor(callback) {
        var windowWidth = $(window).width(),
                windowHeight = $(window).height();
        if (typeof(callback) == 'undefined') {
            callback = {
                portrait: function() {},
                landscape: function() {}
            }
        } else {
            if (windowWidth < windowHeight) {
                return callback.portrait();
            } else {
                return callback.landscape();
            }
        }
    }

    // 尺寸设定集
    function sizeArguObj(zoom) {
        return {
            '-ms-zoom': zoom,
            '-webkit-transform': 'scale(' + zoom + ')',
            '-webkit-transform-origin': 'left top',
            '-moz-transform': 'scale(' + zoom + ')',
            '-moz-transform-origin': 'left center'
        }
    }
</script>
</html>
